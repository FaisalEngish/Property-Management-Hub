import{af as ve,ag as we,r as g,u as H,ah as Ne,ai as A,aG as ye,aj as K,s as te,al as b,aH as ne,aI as le,p as Q,aJ as V,aK as be,a7 as Ce,ao as f,aL as Pe,aM as Se,ad as Re,aN as Ae,j as e,aO as U,C as c,a as d,a3 as v,a9 as ce,d as w,t as ke,v as Ie,w as k,x as I,b as T,c as E,ay as Te,aP as M,L as z,aq as _,I as W,S as J,e as Z,f as X,g as Y,h as ee,V as se,W as ae,Z as p,_ as m,$ as ie,a0 as t,B as N,aD as re,an as Ee,aQ as Me,aR as Ve,aS as Ue}from"./index-FvzW7A1h.js";const l=[{id:"admin",name:"Admin",description:"Full system access",color:"bg-red-500",icon:U},{id:"portfolio-manager",name:"Portfolio Manager",description:"Manages multiple properties",color:"bg-purple-500",icon:V},{id:"owner",name:"Owner",description:"Property owner access",color:"bg-blue-500",icon:te},{id:"retail-agent",name:"Retail Agent",description:"Books properties for guests",color:"bg-green-500",icon:ce},{id:"referral-agent",name:"Referral Agent",description:"Refers properties to guests",color:"bg-yellow-500",icon:f},{id:"staff",name:"Staff",description:"Property maintenance staff",color:"bg-gray-500",icon:le},{id:"guest",name:"Guest",description:"Property guest access",color:"bg-pink-500",icon:ne}],y=[{id:"dashboard-view",module:"Dashboard",feature:"View Dashboard",description:"Access main dashboard",icon:ye,category:"Core"},{id:"dashboard-edit",module:"Dashboard",feature:"Edit Dashboard",description:"Customize dashboard layout",icon:K,category:"Core"},{id:"properties-view",module:"Properties",feature:"View Properties",description:"View property listings",icon:te,category:"Property"},{id:"properties-edit",module:"Properties",feature:"Edit Properties",description:"Modify property details",icon:b,category:"Property"},{id:"checkin-tracker",module:"Check-in Tracker",feature:"Guest Check-in",description:"Track guest arrivals",icon:ne,category:"Property"},{id:"maintenance-system",module:"Maintenance",feature:"Maintenance System",description:"Manage property maintenance",icon:le,category:"Property"},{id:"finances-view",module:"Finances",feature:"View Finances",description:"View financial reports",icon:Q,category:"Financial"},{id:"finances-edit",module:"Finances",feature:"Edit Finances",description:"Modify financial records",icon:b,category:"Financial"},{id:"booking-income",module:"Booking Income",feature:"Booking Revenue",description:"Track booking income",icon:V,category:"Financial"},{id:"payouts",module:"Payouts",feature:"Process Payouts",description:"Handle commission payouts",icon:Q,category:"Financial"},{id:"tasks-view",module:"Tasks",feature:"View Tasks",description:"View task assignments",icon:be,category:"Tasks"},{id:"tasks-edit",module:"Tasks",feature:"Edit Tasks",description:"Create and modify tasks",icon:b,category:"Tasks"},{id:"auto-scheduling",module:"Auto Scheduling",feature:"Automated Rules",description:"Manage recurring tasks",icon:Ce,category:"Tasks"},{id:"user-management",module:"User Management",feature:"Manage Users",description:"Create and manage users",icon:f,category:"Admin"},{id:"system-settings",module:"System Settings",feature:"System Config",description:"Configure system settings",icon:K,category:"Admin"},{id:"ai-notifications",module:"AI Notifications",feature:"Smart Alerts",description:"AI-powered notifications",icon:Pe,category:"Admin"},{id:"activity-logs",module:"Activity Logs",feature:"Audit Trail",description:"View system activity",icon:Se,category:"Admin"},{id:"smart-pricing",module:"Smart Pricing",feature:"AI Pricing",description:"Dynamic pricing tools",icon:Re,category:"Advanced"},{id:"performance-toolkit",module:"Performance",feature:"Analytics",description:"Performance insights",icon:V,category:"Advanced"},{id:"inventory-management",module:"Inventory",feature:"Stock Management",description:"Track inventory items",icon:Ae,category:"Advanced"}],j=[{id:"demo-admin",name:"Admin User",email:"admin@test.com",role:"admin",lastLogin:"2025-01-28 17:30",status:"active"},{id:"demo-pm",name:"Portfolio Manager",email:"manager@test.com",role:"portfolio-manager",lastLogin:"2025-01-28 16:45",status:"active"},{id:"demo-owner",name:"Property Owner",email:"owner@test.com",role:"owner",lastLogin:"2025-01-28 15:20",status:"active"},{id:"demo-staff",name:"Staff Member",email:"staff@test.com",role:"staff",lastLogin:"2025-01-28 14:15",status:"active"},{id:"demo-retail-agent",name:"Retail Agent",email:"retail@test.com",role:"retail-agent",lastLogin:"2025-01-28 13:30",status:"active"},{id:"demo-referral-agent",name:"Referral Agent",email:"referral@test.com",role:"referral-agent",lastLogin:"2025-01-28 12:45",status:"active"}];function qe(){var O;const{toast:u}=ve(),L=we(),[Le,Fe]=g.useState("admin"),[C,de]=g.useState(""),[P,oe]=g.useState("All"),[x,F]=g.useState(null),[me,xe]=g.useState([{roleId:"admin",permissionId:"dashboard-view",canView:!0,canEdit:!0},{roleId:"admin",permissionId:"properties-view",canView:!0,canEdit:!0},{roleId:"admin",permissionId:"finances-view",canView:!0,canEdit:!0},{roleId:"portfolio-manager",permissionId:"dashboard-view",canView:!0,canEdit:!1},{roleId:"portfolio-manager",permissionId:"properties-view",canView:!0,canEdit:!0},{roleId:"portfolio-manager",permissionId:"finances-view",canView:!0,canEdit:!1},{roleId:"owner",permissionId:"dashboard-view",canView:!0,canEdit:!1},{roleId:"owner",permissionId:"properties-view",canView:!0,canEdit:!1},{roleId:"owner",permissionId:"finances-view",canView:!0,canEdit:!1}]),{data:ue=j,isLoading:$}=H({queryKey:["/api/user-management/users"],queryFn:async()=>{try{return(await A("GET","/api/user-management/users")).json()}catch(s){return console.error("Failed to fetch users:",s),j}}}),{data:S={totalUsers:0,activeUsers:0,byRole:{}}}=H({queryKey:["/api/user-management/stats"],queryFn:async()=>{try{return(await A("GET","/api/user-management/stats")).json()}catch(s){return console.error("Failed to fetch user stats:",s),{totalUsers:j.length,activeUsers:j.filter(a=>a.status==="active").length,byRole:j.reduce((a,i)=>(a[i.role]=(a[i.role]||0)+1,a),{})}}}}),D=Ne({mutationFn:async({userId:s,role:a})=>(await A("PUT",`/api/user-management/users/${s}/role`,{primaryRole:a})).json(),onSuccess:()=>{L.invalidateQueries({queryKey:["/api/user-management/users"]}),L.invalidateQueries({queryKey:["/api/user-management/stats"]}),u({title:"Role Updated",description:"User role has been updated successfully"})},onError:s=>{console.error("Failed to update user role:",s),u({title:"Error",description:"Failed to update user role",variant:"destructive"})}}),he=["All",...Array.from(new Set(y.map(s=>s.category)))],ge=y.filter(s=>{const a=s.feature.toLowerCase().includes(C.toLowerCase())||s.module.toLowerCase().includes(C.toLowerCase()),i=P==="All"||s.category===P;return a&&i}),R=(s,a)=>me.find(i=>i.roleId===s&&i.permissionId===a),q=(s,a,i,r)=>{var h;xe(n=>n.find(o=>o.roleId===s&&o.permissionId===a)?n.map(o=>o.roleId===s&&o.permissionId===a?{...o,[i==="view"?"canView":"canEdit"]:r}:o):[...n,{roleId:s,permissionId:a,canView:i==="view"?r:!1,canEdit:i==="edit"?r:!1}]),u({title:"Permission Updated",description:`${i==="view"?"View":"Edit"} access ${r?"granted":"revoked"} for ${(h=l.find(n=>n.id===s))==null?void 0:h.name}`})},B=s=>{var a;F(s),u({title:"Preview Mode Active",description:`Now previewing as ${(a=l.find(i=>i.id===s))==null?void 0:a.name}`,variant:"default"})},G=()=>{F(null),u({title:"Preview Mode Disabled",description:"Returned to Admin view"})},pe=s=>{B(s.role)},je=s=>{const a=l.find(i=>i.id===s);return(a==null?void 0:a.icon)||f},fe=s=>{const a=l.find(i=>i.id===s);return(a==null?void 0:a.color)||"bg-gray-500"};return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(U,{className:"h-8 w-8 text-yellow-500"}),"God Mode & Role Manager"]}),e.jsx("p",{className:"text-muted-foreground",children:"Complete admin control over user roles and permissions"})]}),x&&e.jsx(c,{className:"border-2 border-orange-500",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(v,{className:"h-5 w-5 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Preview Mode Active"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Viewing as: ",(O=l.find(s=>s.id===x))==null?void 0:O.name]})]}),e.jsx(w,{variant:"outline",size:"sm",onClick:G,children:"Exit Preview"})]})})})]}),e.jsxs(ke,{defaultValue:"permissions",className:"space-y-6",children:[e.jsxs(Ie,{className:"grid w-full grid-cols-3",children:[e.jsx(k,{value:"permissions",children:"Role Permissions"}),e.jsx(k,{value:"preview",children:"Preview Roles"}),e.jsx(k,{value:"users",children:"Demo Users"})]}),e.jsx(I,{value:"permissions",className:"space-y-6",children:e.jsxs(c,{children:[e.jsxs(T,{children:[e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5"}),"Role Access Control Panel"]}),e.jsx(M,{children:"Manage view and edit permissions for each role across all system modules"})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(z,{htmlFor:"search",children:"Search Permissions"}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(W,{id:"search",placeholder:"Search modules or features...",value:C,onChange:s=>de(s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx(z,{htmlFor:"category",children:"Category"}),e.jsxs(J,{value:P,onValueChange:oe,children:[e.jsx(Z,{id:"category",children:e.jsx(X,{})}),e.jsx(Y,{children:he.map(s=>e.jsx(ee,{value:s,children:s},s))})]})]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(se,{children:[e.jsx(ae,{children:e.jsxs(p,{children:[e.jsx(m,{className:"w-[300px]",children:"Feature"}),l.map(s=>e.jsx(m,{className:"text-center min-w-[120px]",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(s.icon,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:s.name})]})},s.id))]})}),e.jsx(ie,{children:ge.map(s=>e.jsxs(p,{children:[e.jsx(t,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s.icon,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.feature}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.module})]}),e.jsx(N,{variant:"outline",className:"text-xs",children:s.category})]})}),l.map(a=>{const i=R(a.id,s.id);return e.jsx(t,{className:"text-center",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(v,{className:"h-3 w-3"}),e.jsx(re,{checked:(i==null?void 0:i.canView)||!1,onCheckedChange:r=>q(a.id,s.id,"view",r)})]}),e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(b,{className:"h-3 w-3"}),e.jsx(re,{checked:(i==null?void 0:i.canEdit)||!1,onCheckedChange:r=>q(a.id,s.id,"edit",r)})]})]})},a.id)})]},s.id))})]})})]})]})}),e.jsx(I,{value:"preview",className:"space-y-6",children:e.jsxs(c,{children:[e.jsxs(T,{children:[e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-5 w-5"}),"Role Preview System"]}),e.jsx(M,{children:"Preview the system interface from any role's perspective"})]}),e.jsx(d,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(s=>{const a=s.icon;return e.jsx(c,{className:`cursor-pointer transition-all hover:shadow-lg ${x===s.id?"ring-2 ring-blue-500":""}`,children:e.jsxs(d,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:`p-2 rounded-lg ${s.color} text-white`,children:e.jsx(a,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("p",{className:"text-sm font-medium",children:"Accessible Features:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[y.slice(0,6).map(i=>{const r=R(s.id,i.id);return r!=null&&r.canView?e.jsx(N,{variant:"secondary",className:"text-xs",children:i.module},i.id):null}),e.jsxs(N,{variant:"outline",className:"text-xs",children:["+",y.filter(i=>{var r;return(r=R(s.id,i.id))==null?void 0:r.canView}).length-6," more"]})]})]}),e.jsx(w,{className:"w-full",variant:x===s.id?"default":"outline",onClick:()=>x===s.id?G():B(s.id),children:x===s.id?"Exit Preview":"Preview Role"})]})},s.id)})})})]})}),e.jsx(I,{value:"users",className:"space-y-6",children:e.jsxs(c,{children:[e.jsxs(T,{children:[e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(f,{className:"h-5 w-5"}),"User Management System",$&&e.jsx("div",{className:"h-4 w-4 border-2 border-gray-300 border-t-blue-500 rounded-full animate-spin"})]}),e.jsx(M,{children:"Manage user accounts, roles, and permissions with real-time API integration"})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(c,{children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold",children:S.totalUsers})]})]})})}),e.jsx(c,{children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active Users"}),e.jsx("p",{className:"text-2xl font-bold",children:S.activeUsers})]})]})})}),e.jsx(c,{children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5 text-purple-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Roles Configured"}),e.jsx("p",{className:"text-2xl font-bold",children:Object.keys(S.byRole||{}).length})]})]})})})]}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("div",{className:"flex gap-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(W,{placeholder:"Search users...",className:"pl-10 w-64"})]})}),e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Create Demo User"]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(se,{children:[e.jsx(ae,{children:e.jsxs(p,{children:[e.jsx(m,{children:"User"}),e.jsx(m,{children:"Role"}),e.jsx(m,{children:"Last Login"}),e.jsx(m,{children:"Status"}),e.jsx(m,{children:"Actions"})]})}),e.jsx(ie,{children:$?Array(5).fill(0).map((s,a)=>e.jsxs(p,{children:[e.jsx(t,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 bg-gray-200 rounded-full animate-pulse"}),e.jsxs("div",{children:[e.jsx("div",{className:"h-4 w-24 bg-gray-200 rounded animate-pulse mb-1"}),e.jsx("div",{className:"h-3 w-32 bg-gray-200 rounded animate-pulse"})]})]})}),e.jsx(t,{children:e.jsx("div",{className:"h-4 w-20 bg-gray-200 rounded animate-pulse"})}),e.jsx(t,{children:e.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded animate-pulse"})}),e.jsx(t,{children:e.jsx("div",{className:"h-4 w-12 bg-gray-200 rounded animate-pulse"})}),e.jsx(t,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"h-8 w-16 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-8 w-16 bg-gray-200 rounded animate-pulse"})]})})]},a)):ue.map(s=>{var i,r,h;const a=je(s.primaryRole||s.role);return e.jsxs(p,{children:[e.jsx(t,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(Me,{className:"h-8 w-8",children:[e.jsx(Ve,{src:s.profileImageUrl}),e.jsx(Ue,{children:s.firstName&&s.lastName?`${s.firstName[0]}${s.lastName[0]}`:((r=(i=s.email)==null?void 0:i[0])==null?void 0:r.toUpperCase())||"?"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.email}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email})]})]})}),e.jsx(t,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-1 rounded ${fe(s.primaryRole||s.role)} text-white`,children:e.jsx(a,{className:"h-3 w-3"})}),e.jsx("span",{className:"capitalize",children:((h=s.primaryRole||s.role)==null?void 0:h.replace("-"," "))||"No Role"})]})}),e.jsx(t,{className:"text-sm text-muted-foreground",children:s.lastLogin||"Never"}),e.jsx(t,{children:e.jsx(N,{variant:s.isActive!==!1?"default":"secondary",children:s.isActive!==!1?"active":"inactive"})}),e.jsx(t,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>pe({id:s.id,name:s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.email,email:s.email,role:s.primaryRole||s.role,lastLogin:s.lastLogin||"Never",status:s.isActive!==!1?"active":"inactive"}),className:"flex items-center gap-1",children:[e.jsx(v,{className:"h-3 w-3"}),"Preview"]}),e.jsxs(J,{value:s.primaryRole||s.role||"",onValueChange:n=>D.mutate({userId:s.id,role:n}),disabled:D.isPending,children:[e.jsx(Z,{className:"w-32",children:e.jsx(X,{placeholder:"Role"})}),e.jsx(Y,{children:l.map(n=>e.jsx(ee,{value:n.id,children:n.name},n.id))})]})]})})]},s.id)})})]})})]})]})})]})]})}export{qe as default};
