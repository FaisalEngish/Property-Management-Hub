import{U as me,r as U,u as D,j as e,d as f,X as he,L as $,P as ne,i as re,k as le,m as K,n as ie,o as de,S as H,e as Y,f as G,g as J,h as A,C as g,b as v,c as y,p as Z,a as u,V as T,W as F,Z as k,_ as d,$ as O,a0 as c,a1 as je,a2 as ge,a3 as ve,a4 as ue,a5 as pe,a6 as Ne,B as b,a7 as M,a8 as W,a9 as V,aa as Q,T as _,ab as X,ac as ce,ad as ye,ae as be,af as Se,ag as we,ah as ke,ai as Pe,aj as fe,ak as Ce,al as De,I as q,am as Me,an as Re,F as Ie,D as Le,ao as oe,t as Ae,v as $e,w as E,x as B}from"./index-FvzW7A1h.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=me("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=me("UsersRound",[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]]);function Fe({filters:l,onFiltersChange:o}){var r,j;const[a,h]=U.useState(l),{data:N=[]}=D({queryKey:["/api/properties"],select:n=>n||[]}),{data:p=[]}=D({queryKey:["/api/users"],select:n=>n||[]}),x=()=>{o(a)},t=()=>{const n={};h(n),o(n)},s=p.filter(n=>n.role==="portfolio-manager"||n.role==="admin"),i=p.filter(n=>n.role==="retail-agent"||n.role==="referral-agent");return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Filters"}),e.jsxs(f,{variant:"outline",size:"sm",onClick:t,children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Clear All"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Start Date"}),e.jsxs(ne,{children:[e.jsx(re,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),a.startDate?le(a.startDate,"MMM dd, yyyy"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(ie,{className:"w-auto p-0",children:e.jsx(de,{mode:"single",selected:a.startDate,onSelect:n=>h({...a,startDate:n}),initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"End Date"}),e.jsxs(ne,{children:[e.jsx(re,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),a.endDate?le(a.endDate,"MMM dd, yyyy"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(ie,{className:"w-auto p-0",children:e.jsx(de,{mode:"single",selected:a.endDate,onSelect:n=>h({...a,endDate:n}),initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Properties"}),e.jsxs(H,{value:((r=a.propertyIds)==null?void 0:r.join(","))||"",onValueChange:n=>{h(n?{...a,propertyIds:n.split(",").map(Number)}:{...a,propertyIds:void 0})},children:[e.jsx(Y,{children:e.jsx(G,{placeholder:"All Properties"})}),e.jsxs(J,{children:[e.jsx(A,{value:"",children:"All Properties"}),N.map(n=>e.jsx(A,{value:n.id.toString(),children:n.name},n.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Stakeholders"}),e.jsxs(H,{value:((j=a.stakeholderIds)==null?void 0:j.join(","))||"",onValueChange:n=>{h(n?{...a,stakeholderIds:n.split(",")}:{...a,stakeholderIds:void 0})},children:[e.jsx(Y,{children:e.jsx(G,{placeholder:"All Stakeholders"})}),e.jsxs(J,{children:[e.jsx(A,{value:"",children:"All Stakeholders"}),s.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(A,{value:"",disabled:!0,children:"Property Managers"}),s.map(n=>e.jsxs(A,{value:n.id,children:[n.firstName," ",n.lastName]},n.id))]}),i.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(A,{value:"",disabled:!0,children:"Agents"}),i.map(n=>e.jsxs(A,{value:n.id,children:[n.firstName," ",n.lastName]},n.id))]})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(f,{variant:"outline",size:"sm",onClick:()=>{const n=new Date,P=new Date(n.getFullYear(),n.getMonth(),1);h({...a,startDate:P,endDate:n})},children:"This Month"}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>{const n=new Date,P=new Date(n.getFullYear(),n.getMonth()-1,1),R=new Date(n.getFullYear(),n.getMonth(),0);h({...a,startDate:P,endDate:R})},children:"Last Month"}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>{const n=new Date,P=new Date(n.getFullYear(),Math.floor(n.getMonth()/3)*3,1);h({...a,startDate:P,endDate:n})},children:"This Quarter"}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>{const n=new Date,P=new Date(n.getFullYear(),0,1);h({...a,startDate:P,endDate:n})},children:"This Year"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(f,{onClick:x,children:"Apply Filters"})})]})}function Oe({filters:l}){const o=new URLSearchParams;l.startDate&&o.set("startDate",l.startDate.toISOString()),l.endDate&&o.set("endDate",l.endDate.toISOString()),l.propertyIds&&o.set("propertyIds",l.propertyIds.join(",")),l.stakeholderIds&&o.set("ownerIds",l.stakeholderIds.join(","));const{data:a=[],isLoading:h}=D({queryKey:[`/api/admin/finance/owner-payouts?${o}`]}),N=(t,s)=>{console.log("Mark paid:",t,s)},p=t=>{switch(t){case"paid":return e.jsxs(b,{variant:"default",className:"bg-green-100 text-green-800",children:[e.jsx(W,{className:"w-3 h-3 mr-1"}),"Paid"]});case"queued":return e.jsxs(b,{variant:"secondary",children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"Queued"]});default:return e.jsxs(b,{variant:"outline",children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"Pending"]})}};if(h)return e.jsx("div",{className:"animate-pulse space-y-4",children:Array.from({length:5}).map((t,s)=>e.jsx("div",{className:"h-16 bg-gray-200 rounded"},s))});const x=a.reduce((t,s)=>t+s.earnings.net,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g,{children:[e.jsx(v,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5"}),"Owner Payouts Summary"]})}),e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Payouts Due"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",x.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Number of Owners"}),e.jsx("p",{className:"text-2xl font-bold",children:a.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Properties Involved"}),e.jsx("p",{className:"text-2xl font-bold",children:a.reduce((t,s)=>t+s.properties.length,0)})]})]})})]}),e.jsxs(g,{children:[e.jsx(v,{children:e.jsx(y,{children:"Owner Payouts"})}),e.jsxs(u,{children:[e.jsxs(T,{children:[e.jsx(F,{children:e.jsxs(k,{children:[e.jsx(d,{children:"Owner"}),e.jsx(d,{children:"Properties"}),e.jsx(d,{className:"text-right",children:"Gross Revenue"}),e.jsx(d,{className:"text-right",children:"Management Fees"}),e.jsx(d,{className:"text-right",children:"Net Payout"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Actions"})]})}),e.jsx(O,{children:a.map(t=>e.jsxs(k,{children:[e.jsx(c,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.stakeholderName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.stakeholderId})]})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-1",children:[t.properties.slice(0,2).map(s=>e.jsx("div",{className:"text-sm",children:s.propertyName},s.propertyId)),t.properties.length>2&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["+",t.properties.length-2," more"]})]})}),e.jsxs(c,{className:"text-right",children:["$",t.earnings.gross.toLocaleString()]}),e.jsxs(c,{className:"text-right",children:["$",t.earnings.deductions.toLocaleString()]}),e.jsxs(c,{className:"text-right font-medium",children:["$",t.earnings.net.toLocaleString()]}),e.jsx(c,{children:p(t.earnings.status)}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(je,{children:[e.jsx(ge,{asChild:!0,children:e.jsx(f,{variant:"outline",size:"sm",children:e.jsx(ve,{className:"w-4 h-4"})})}),e.jsxs(ue,{className:"max-w-2xl",children:[e.jsx(pe,{children:e.jsxs(Ne,{children:[t.stakeholderName," - Property Breakdown"]})}),e.jsx("div",{className:"space-y-4",children:e.jsxs(T,{children:[e.jsx(F,{children:e.jsxs(k,{children:[e.jsx(d,{children:"Property"}),e.jsx(d,{className:"text-right",children:"Revenue"}),e.jsx(d,{className:"text-right",children:"Management Fee"}),e.jsx(d,{className:"text-right",children:"Net Payout"})]})}),e.jsx(O,{children:t.properties.map(s=>e.jsxs(k,{children:[e.jsx(c,{children:s.propertyName}),e.jsxs(c,{className:"text-right",children:["$",s.revenue.toLocaleString()]}),e.jsxs(c,{className:"text-right",children:["$",(s.revenue-s.commission).toLocaleString()]}),e.jsxs(c,{className:"text-right font-medium",children:["$",s.commission.toLocaleString()]})]},s.propertyId))})]})})]})]}),t.earnings.status==="pending"&&e.jsx(f,{size:"sm",onClick:()=>N(t.stakeholderId,t.earnings.net),children:"Mark Paid"})]})})]},t.stakeholderId))})]}),a.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No owner payouts found for the selected period."})]})]})]})}function qe({filters:l}){const o=new URLSearchParams;l.startDate&&o.set("startDate",l.startDate.toISOString()),l.endDate&&o.set("endDate",l.endDate.toISOString()),l.propertyIds&&o.set("propertyIds",l.propertyIds.join(",")),l.stakeholderIds&&o.set("managerIds",l.stakeholderIds.join(","));const{data:a=[],isLoading:h}=D({queryKey:[`/api/admin/finance/pm-earnings?${o}`]}),N=(t,s)=>{console.log("Mark paid:",t,s)},p=t=>{switch(t){case"paid":return e.jsxs(b,{variant:"default",className:"bg-green-100 text-green-800",children:[e.jsx(W,{className:"w-3 h-3 mr-1"}),"Paid"]});case"queued":return e.jsxs(b,{variant:"secondary",children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"Queued"]});default:return e.jsxs(b,{variant:"outline",children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"Pending"]})}};if(h)return e.jsx("div",{className:"animate-pulse space-y-4",children:Array.from({length:5}).map((t,s)=>e.jsx("div",{className:"h-16 bg-gray-200 rounded"},s))});const x=a.reduce((t,s)=>t+s.earnings.net,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g,{children:[e.jsx(v,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"Property Manager Earnings Summary"]})}),e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total PM Earnings"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",x.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active Managers"}),e.jsx("p",{className:"text-2xl font-bold",children:a.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Properties Managed"}),e.jsx("p",{className:"text-2xl font-bold",children:a.reduce((t,s)=>t+s.properties.length,0)})]})]})})]}),e.jsxs(g,{children:[e.jsx(v,{children:e.jsx(y,{children:"Property Manager Commission Earnings"})}),e.jsxs(u,{children:[e.jsxs(T,{children:[e.jsx(F,{children:e.jsxs(k,{children:[e.jsx(d,{children:"Property Manager"}),e.jsx(d,{children:"Properties Managed"}),e.jsx(d,{className:"text-right",children:"Total Revenue Generated"}),e.jsx(d,{className:"text-right",children:"Commission Split"}),e.jsx(d,{className:"text-right",children:"Earnings"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Actions"})]})}),e.jsx(O,{children:a.map(t=>{const s=t.properties.reduce((r,j)=>r+j.revenue,0);return e.jsxs(k,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(V,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.stakeholderName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Portfolio Manager"})]})]})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-1",children:[t.properties.slice(0,2).map(r=>e.jsxs("div",{className:"text-sm flex items-center gap-1",children:[e.jsx(Q,{className:"w-3 h-3"}),r.propertyName]},r.propertyId)),t.properties.length>2&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["+",t.properties.length-2," more properties"]})]})}),e.jsx(c,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(_,{className:"w-4 h-4 text-green-600"}),"$",s.toLocaleString()]})}),e.jsx(c,{className:"text-right",children:e.jsxs(b,{variant:"secondary",children:[50,"%"]})}),e.jsxs(c,{className:"text-right font-medium",children:["$",t.earnings.net.toLocaleString()]}),e.jsx(c,{children:p(t.earnings.status)}),e.jsx(c,{children:t.earnings.status==="pending"&&e.jsx(f,{size:"sm",onClick:()=>N(t.stakeholderId,t.earnings.net),children:"Mark Paid"})})]},t.stakeholderId)})})]}),a.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No property manager earnings found for the selected period."})]})]}),a.length>0&&e.jsxs(g,{children:[e.jsx(v,{children:e.jsx(y,{children:"Performance Insights"})}),e.jsx(u,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(t=>{const s=t.properties.reduce((i,r)=>i+r.revenue,0)/t.properties.length;return e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:t.stakeholderName}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Properties:"}),e.jsx("span",{children:t.properties.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Avg Revenue/Property:"}),e.jsxs("span",{children:["$",s.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Commission Rate:"}),e.jsx("span",{children:"50%"})]})]})]},t.stakeholderId)})})})]})]})}function Ee({filters:l}){const o=new URLSearchParams;l.startDate&&o.set("startDate",l.startDate.toISOString()),l.endDate&&o.set("endDate",l.endDate.toISOString()),l.stakeholderIds&&o.set("agentIds",l.stakeholderIds.join(","));const{data:a=[],isLoading:h}=D({queryKey:[`/api/admin/finance/agent-referral?${o}`]}),N=(s,i)=>{console.log("Mark paid:",s,i)},p=s=>{switch(s){case"paid":return e.jsxs(b,{variant:"default",className:"bg-green-100 text-green-800",children:[e.jsx(W,{className:"w-3 h-3 mr-1"}),"Paid"]});case"queued":return e.jsxs(b,{variant:"secondary",children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"Queued"]});default:return e.jsxs(b,{variant:"outline",children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"Pending"]})}};if(h)return e.jsx("div",{className:"animate-pulse space-y-4",children:Array.from({length:5}).map((s,i)=>e.jsx("div",{className:"h-16 bg-gray-200 rounded"},i))});const x=a.reduce((s,i)=>s+i.earnings.net,0),t=a.reduce((s,i)=>s+i.properties.length,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g,{children:[e.jsx(v,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5"}),"Referral Agent Commission Summary"]})}),e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Referral Commissions"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",x.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active Referral Agents"}),e.jsx("p",{className:"text-2xl font-bold",children:a.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Referrals"}),e.jsx("p",{className:"text-2xl font-bold",children:t})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg Commission/Agent"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",a.length>0?Math.round(x/a.length).toLocaleString():"0"]})]})]})})]}),e.jsxs(g,{children:[e.jsx(v,{children:e.jsx(y,{children:"Referral Agent Commissions"})}),e.jsxs(u,{children:[e.jsxs(T,{children:[e.jsx(F,{children:e.jsxs(k,{children:[e.jsx(d,{children:"Referral Agent"}),e.jsx(d,{children:"Referrals"}),e.jsx(d,{className:"text-right",children:"Total Referral Value"}),e.jsx(d,{className:"text-right",children:"Commission Rate"}),e.jsx(d,{className:"text-right",children:"Commission Earned"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Actions"})]})}),e.jsx(O,{children:a.map(s=>{const i=s.properties.reduce((j,n)=>j+n.revenue,0);return e.jsxs(k,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center",children:e.jsx(xe,{className:"w-4 h-4 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.stakeholderName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Referral Agent"})]})]})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium",children:s.properties.length}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"referrals"})]})}),e.jsx(c,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(_,{className:"w-4 h-4 text-green-600"}),"$",i.toLocaleString()]})}),e.jsx(c,{className:"text-right",children:e.jsxs(b,{variant:"secondary",children:[5,"%"]})}),e.jsxs(c,{className:"text-right font-medium",children:["$",s.earnings.net.toLocaleString()]}),e.jsx(c,{children:p(s.earnings.status)}),e.jsx(c,{children:s.earnings.status==="pending"&&e.jsx(f,{size:"sm",onClick:()=>N(s.stakeholderId,s.earnings.net),children:"Mark Paid"})})]},s.stakeholderId)})})]}),a.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No referral agent commissions found for the selected period."})]})]}),a.length>0&&e.jsxs(g,{children:[e.jsx(v,{children:e.jsx(y,{children:"Top Referral Performers"})}),e.jsx(u,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.sort((s,i)=>i.earnings.net-s.earnings.net).slice(0,6).map((s,i)=>e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i===0&&e.jsx("div",{className:"w-2 h-2 bg-gold-500 rounded-full"}),i===1&&e.jsx("div",{className:"w-2 h-2 bg-silver-500 rounded-full"}),i===2&&e.jsx("div",{className:"w-2 h-2 bg-bronze-500 rounded-full"}),e.jsx("h4",{className:"font-medium",children:s.stakeholderName})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Referrals:"}),e.jsx("span",{children:s.properties.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Commission:"}),e.jsxs("span",{className:"font-medium",children:["$",s.earnings.net.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Avg/Referral:"}),e.jsxs("span",{children:["$",Math.round(s.earnings.net/s.properties.length).toLocaleString()]})]})]})]},s.stakeholderId))})})]})]})}function Be({filters:l}){const o=new URLSearchParams;l.startDate&&o.set("startDate",l.startDate.toISOString()),l.endDate&&o.set("endDate",l.endDate.toISOString()),l.stakeholderIds&&o.set("agentIds",l.stakeholderIds.join(","));const{data:a=[],isLoading:h}=D({queryKey:[`/api/admin/finance/agent-retail?${o}`]}),N=(s,i)=>{console.log("Mark paid:",s,i)},p=s=>{switch(s){case"paid":return e.jsxs(b,{variant:"default",className:"bg-green-100 text-green-800",children:[e.jsx(W,{className:"w-3 h-3 mr-1"}),"Paid"]});case"queued":return e.jsxs(b,{variant:"secondary",children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"Queued"]});default:return e.jsxs(b,{variant:"outline",children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"Pending"]})}};if(h)return e.jsx("div",{className:"animate-pulse space-y-4",children:Array.from({length:5}).map((s,i)=>e.jsx("div",{className:"h-16 bg-gray-200 rounded"},i))});const x=a.reduce((s,i)=>s+i.earnings.net,0),t=a.reduce((s,i)=>s+i.properties.length,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g,{children:[e.jsx(v,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5"}),"Retail Agent Commission Summary"]})}),e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Retail Commissions"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",x.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active Retail Agents"}),e.jsx("p",{className:"text-2xl font-bold",children:a.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Direct Bookings"}),e.jsx("p",{className:"text-2xl font-bold",children:t})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg Commission/Agent"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",a.length>0?Math.round(x/a.length).toLocaleString():"0"]})]})]})})]}),e.jsxs(g,{children:[e.jsx(v,{children:e.jsx(y,{children:"Retail Agent Commissions"})}),e.jsxs(u,{children:[e.jsxs(T,{children:[e.jsx(F,{children:e.jsxs(k,{children:[e.jsx(d,{children:"Retail Agent"}),e.jsx(d,{children:"Direct Bookings"}),e.jsx(d,{className:"text-right",children:"Total Booking Value"}),e.jsx(d,{className:"text-right",children:"Commission Rate"}),e.jsx(d,{className:"text-right",children:"Commission Earned"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Actions"})]})}),e.jsx(O,{children:a.map(s=>{const i=s.properties.reduce((j,n)=>j+n.revenue,0);return e.jsxs(k,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center",children:e.jsx(ce,{className:"w-4 h-4 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.stakeholderName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Retail Agent"})]})]})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium",children:s.properties.length}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"bookings"})]})}),e.jsx(c,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(_,{className:"w-4 h-4 text-green-600"}),"$",i.toLocaleString()]})}),e.jsx(c,{className:"text-right",children:e.jsxs(b,{variant:"secondary",children:[7,"%"]})}),e.jsxs(c,{className:"text-right font-medium",children:["$",s.earnings.net.toLocaleString()]}),e.jsx(c,{children:p(s.earnings.status)}),e.jsx(c,{children:s.earnings.status==="pending"&&e.jsx(f,{size:"sm",onClick:()=>N(s.stakeholderId,s.earnings.net),children:"Mark Paid"})})]},s.stakeholderId)})})]}),a.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No retail agent commissions found for the selected period."})]})]}),a.length>0&&e.jsxs(g,{children:[e.jsx(v,{children:e.jsx(y,{children:"Sales Performance Metrics"})}),e.jsx(u,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.sort((s,i)=>i.earnings.net-s.earnings.net).map(s=>{const i=s.properties.reduce((j,n)=>j+n.revenue,0)/s.properties.length,r=s.earnings.net/s.properties.length;return e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ye,{className:"w-4 h-4 text-purple-600"}),e.jsx("h4",{className:"font-medium",children:s.stakeholderName})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Bookings:"}),e.jsx("span",{children:s.properties.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Avg Booking Value:"}),e.jsxs("span",{children:["$",i.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Commission/Booking:"}),e.jsxs("span",{children:["$",Math.round(r).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Earned:"}),e.jsxs("span",{className:"font-medium",children:["$",s.earnings.net.toLocaleString()]})]})]})]},s.stakeholderId)})})})]}),e.jsxs(g,{children:[e.jsx(v,{children:e.jsx(y,{children:"Monthly Booking Performance"})}),e.jsx(u,{children:e.jsx("div",{className:"h-64 flex items-center justify-center bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(K,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Booking performance chart"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Would show monthly trends and targets"})]})})})]})]})}function Ue({filters:l}){const o=new URLSearchParams;l.startDate&&o.set("startDate",l.startDate.toISOString()),l.endDate&&o.set("endDate",l.endDate.toISOString()),l.stakeholderIds&&o.set("staffIds",l.stakeholderIds.join(","));const{data:a=[],isLoading:h}=D({queryKey:[`/api/admin/finance/staff-wages?${o}`]}),N=(r,j)=>{console.log("Mark paid:",r,j)},p=r=>{switch(r){case"paid":return e.jsxs(b,{variant:"default",className:"bg-green-100 text-green-800",children:[e.jsx(W,{className:"w-3 h-3 mr-1"}),"Paid"]});case"queued":return e.jsxs(b,{variant:"secondary",children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"Queued"]});default:return e.jsxs(b,{variant:"outline",children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"Pending"]})}},x=r=>{const j={"Head of Housekeeping":"bg-blue-100 text-blue-800","Maintenance Manager":"bg-green-100 text-green-800","Guest Services":"bg-purple-100 text-purple-800","Property Coordinator":"bg-orange-100 text-orange-800"};return e.jsx(b,{variant:"secondary",className:j[r]||"bg-gray-100 text-gray-800",children:r})};if(h)return e.jsx("div",{className:"animate-pulse space-y-4",children:Array.from({length:5}).map((r,j)=>e.jsx("div",{className:"h-16 bg-gray-200 rounded"},j))});const t=a.reduce((r,j)=>r+j.earnings.net,0),s=a.reduce((r,j)=>r+j.earnings.gross,0),i=a.reduce((r,j)=>r+j.earnings.deductions,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g,{children:[e.jsx(v,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5"}),"Staff Wages Summary"]})}),e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Net Wages"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",t.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Gross Wages"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",s.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Deductions"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",i.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Staff Members"}),e.jsx("p",{className:"text-2xl font-bold",children:a.length})]})]})})]}),e.jsxs(g,{children:[e.jsx(v,{children:e.jsx(y,{children:"Staff Wage Payments"})}),e.jsxs(u,{children:[e.jsxs(T,{children:[e.jsx(F,{children:e.jsxs(k,{children:[e.jsx(d,{children:"Staff Member"}),e.jsx(d,{children:"Position"}),e.jsx(d,{className:"text-right",children:"Gross Wage"}),e.jsx(d,{className:"text-right",children:"Deductions"}),e.jsx(d,{className:"text-right",children:"Net Pay"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Actions"})]})}),e.jsx(O,{children:a.map(r=>e.jsxs(k,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center",children:e.jsx(be,{className:"w-4 h-4 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:r.stakeholderName}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: ",r.stakeholderId]})]})]})}),e.jsx(c,{children:x(r.position)}),e.jsx(c,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(Z,{className:"w-4 h-4 text-green-600"}),"$",r.earnings.gross.toLocaleString()]})}),e.jsxs(c,{className:"text-right",children:[e.jsxs("div",{className:"text-red-600",children:["-$",r.earnings.deductions.toLocaleString()]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Tax & Benefits"})]}),e.jsxs(c,{className:"text-right font-medium",children:["$",r.earnings.net.toLocaleString()]}),e.jsx(c,{children:p(r.earnings.status)}),e.jsx(c,{children:r.earnings.status==="pending"&&e.jsx(f,{size:"sm",onClick:()=>N(r.stakeholderId,r.earnings.net),children:"Mark Paid"})})]},r.stakeholderId))})]}),a.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No staff wage records found for the selected period."})]})]}),a.length>0&&e.jsxs(g,{children:[e.jsx(v,{children:e.jsx(y,{children:"Payroll Breakdown by Position"})}),e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"Wages by Position"}),e.jsx("div",{className:"space-y-3",children:a.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-indigo-500 rounded-full"}),e.jsx("span",{className:"text-sm",children:r.position})]}),e.jsxs("span",{className:"font-medium",children:["$",r.earnings.net.toLocaleString()]})]},r.stakeholderId))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"Common Deductions"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg",children:[e.jsx("span",{className:"text-sm",children:"Income Tax"}),e.jsxs("span",{className:"font-medium",children:["$",Math.round(i*.6).toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg",children:[e.jsx("span",{className:"text-sm",children:"Social Security"}),e.jsxs("span",{className:"font-medium",children:["$",Math.round(i*.25).toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg",children:[e.jsx("span",{className:"text-sm",children:"Health Insurance"}),e.jsxs("span",{className:"font-medium",children:["$",Math.round(i*.15).toLocaleString()]})]})]})]})]})})]}),e.jsxs(g,{children:[e.jsx(v,{children:e.jsx(y,{children:"Payroll Schedule"})}),e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(K,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-medium",children:"Next Payroll"})]}),e.jsx("p",{className:"text-2xl font-bold mb-1",children:"Dec 31, 2024"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Monthly payroll processing"})]}),e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(W,{className:"w-5 h-5 text-green-600"}),e.jsx("h4",{className:"font-medium",children:"Last Processed"})]}),e.jsx("p",{className:"text-2xl font-bold mb-1",children:"Nov 30, 2024"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"All payments completed"})]}),e.jsxs("div",{className:"p-4 bg-orange-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(M,{className:"w-5 h-5 text-orange-600"}),e.jsx("h4",{className:"font-medium",children:"Pending Actions"})]}),e.jsx("p",{className:"text-2xl font-bold mb-1",children:a.filter(r=>r.earnings.status==="pending").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Staff payments pending"})]})]})})]})]})}function We(){var ee,se,ae,te;const{toast:l}=Se(),o=we(),[a,h]=U.useState(!1),[N,p]=U.useState(null),{data:x,isLoading:t}=D({queryKey:["/api/admin/finance/commission-settings"]}),{data:s=[]}=D({queryKey:["/api/users"]}),{data:i=[]}=D({queryKey:["/api/properties"]}),r=ke({mutationFn:m=>Pe("/api/admin/finance/commission-settings",{method:"PUT",body:JSON.stringify(m)}),onSuccess:()=>{o.invalidateQueries({queryKey:["/api/admin/finance/commission-settings"]}),h(!1),p(null),l({title:"Settings Updated",description:"Commission settings have been successfully updated."})},onError:()=>{l({title:"Error",description:"Failed to update commission settings.",variant:"destructive"})}}),j=()=>{p(JSON.parse(JSON.stringify(x))),h(!0)},n=()=>{r.mutate(N)},P=()=>{h(!1),p(null)},R=s.filter(m=>m.role==="portfolio-manager"||m.role==="admin");if(t||!x)return e.jsx("div",{className:"animate-pulse space-y-4",children:Array.from({length:3}).map((m,S)=>e.jsx("div",{className:"h-32 bg-gray-200 rounded"},S))});const I=a?N:x;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5"}),"Commission Settings"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure commission rates and splits for all stakeholders"})]}),e.jsx("div",{className:"flex gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsxs(f,{variant:"outline",onClick:P,disabled:r.isPending,children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(f,{onClick:n,disabled:r.isPending,children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Save Changes"]})]}):e.jsxs(f,{onClick:j,children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"Edit Settings"]})})]}),e.jsxs(g,{children:[e.jsx(v,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"Property Manager Commission Splits"]})}),e.jsxs(u,{children:[e.jsxs(T,{children:[e.jsx(F,{children:e.jsxs(k,{children:[e.jsx(d,{children:"Property Manager"}),e.jsx(d,{children:"Commission Split %"}),e.jsx(d,{children:"Properties Managed"}),a&&e.jsx(d,{children:"Actions"})]})}),e.jsx(O,{children:Object.entries(I.propertyManagerSplits||{}).map(([m,S])=>{const C=s.find(w=>w.id===m),z=C?`${C.firstName} ${C.lastName}`:m;return e.jsxs(k,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4 text-blue-600"}),z]})}),e.jsx(c,{children:a?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{type:"number",value:S.splitPercentage,onChange:w=>{const L={...N};L.propertyManagerSplits[m].splitPercentage=parseInt(w.target.value),p(L)},className:"w-20"}),e.jsx(Me,{className:"w-4 h-4 text-gray-400"})]}):e.jsxs("span",{children:[S.splitPercentage,"%"]})}),e.jsxs(c,{children:[S.properties.length," properties"]}),a&&e.jsx(c,{children:e.jsx(f,{variant:"outline",size:"sm",onClick:()=>{const w={...N};delete w.propertyManagerSplits[m],p(w)},children:"Remove"})})]},m)})})]}),a&&e.jsx("div",{className:"mt-4",children:e.jsxs(je,{children:[e.jsx(ge,{asChild:!0,children:e.jsxs(f,{variant:"outline",size:"sm",children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Add Property Manager"]})}),e.jsxs(ue,{children:[e.jsx(pe,{children:e.jsx(Ne,{children:"Add Property Manager"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx($,{children:"Property Manager"}),e.jsxs(H,{children:[e.jsx(Y,{children:e.jsx(G,{placeholder:"Select property manager"})}),e.jsx(J,{children:R.map(m=>e.jsxs(A,{value:m.id,children:[m.firstName," ",m.lastName]},m.id))})]})]}),e.jsxs("div",{children:[e.jsx($,{children:"Commission Split %"}),e.jsx(q,{type:"number",placeholder:"50"})]}),e.jsx(f,{className:"w-full",children:"Add Manager"})]})]})]})})]})]}),e.jsxs(g,{children:[e.jsx(v,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Owner Contract Rates (Management Fee %)"]})}),e.jsx(u,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(I.ownerContractRates||{}).map(([m,S])=>{const C=i.find(w=>w.id===parseInt(m)),z=(C==null?void 0:C.name)||`Property ${m}`;return e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Q,{className:"w-4 h-4 text-blue-600"}),e.jsx("h4",{className:"font-medium",children:z})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"text-sm",children:"Management Fee:"}),a?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(q,{type:"number",value:S,onChange:w=>{const L={...N};L.ownerContractRates[m]=parseInt(w.target.value),p(L)},className:"w-16 h-8"}),e.jsx("span",{className:"text-sm",children:"%"})]}):e.jsxs("span",{className:"font-medium",children:[S,"%"]})]})]},m)})})})]}),e.jsxs(g,{children:[e.jsx(v,{children:e.jsx(y,{children:"Agent Commission Rates"})}),e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"p-4 bg-orange-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Referral Agent Rate"}),e.jsx("div",{className:"flex items-center gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx(q,{type:"number",value:((ee=I.agentCommissionRates)==null?void 0:ee.referral)||5,onChange:m=>{const S={...N};S.agentCommissionRates.referral=parseInt(m.target.value),p(S)},className:"w-20"}),e.jsx("span",{children:"% of booking value"})]}):e.jsxs("span",{className:"text-2xl font-bold",children:[((se=I.agentCommissionRates)==null?void 0:se.referral)||5,"%"]})}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Commission for referred bookings"})]}),e.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Retail Agent Rate"}),e.jsx("div",{className:"flex items-center gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx(q,{type:"number",value:((ae=I.agentCommissionRates)==null?void 0:ae.retail)||7,onChange:m=>{const S={...N};S.agentCommissionRates.retail=parseInt(m.target.value),p(S)},className:"w-20"}),e.jsx("span",{children:"% of booking value"})]}):e.jsxs("span",{className:"text-2xl font-bold",children:[((te=I.agentCommissionRates)==null?void 0:te.retail)||7,"%"]})}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Commission for direct sales"})]})]})})]}),e.jsxs(g,{children:[e.jsx(v,{children:e.jsx(y,{children:"Staff Wage Rates (Monthly)"})}),e.jsx(u,{children:e.jsx("div",{className:"space-y-4",children:Object.entries(I.staffWageRates||{}).map(([m,S])=>{const C=s.find(w=>w.id===m),z=C?`${C.firstName} ${C.lastName}`:m;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:z}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Staff Member"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Monthly Rate:"}),a?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"$"}),e.jsx(q,{type:"number",value:S,onChange:w=>{const L={...N};L.staffWageRates[m]=parseInt(w.target.value),p(L)},className:"w-24 h-8"})]}):e.jsxs("span",{className:"font-medium",children:["$",S.toLocaleString()]})]})]},m)})})})]})]})}function Ke(){var i,r,j,n;const[l,o]=U.useState("overview"),[a,h]=U.useState({}),[N,p]=U.useState(!1),{data:x,isLoading:t}=D({queryKey:["/api/admin/finance/overview",a],enabled:!0}),s=P=>{const R=new URLSearchParams;a.startDate&&R.set("startDate",a.startDate.toISOString()),a.endDate&&R.set("endDate",a.endDate.toISOString()),a.propertyIds&&R.set("propertyIds",a.propertyIds.join(","));const I=`/api/admin/finance/export/${P}?${R}`;window.open(I,"_blank")};return t?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded mb-4"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:Array.from({length:4}).map((P,R)=>e.jsx("div",{className:"h-24 bg-gray-200 rounded"},R))})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Admin Finance"}),e.jsx("p",{className:"text-muted-foreground",children:"Unified financial management for all stakeholders"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(f,{variant:"outline",onClick:()=>p(!N),className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Filters"]}),e.jsxs(f,{onClick:()=>s(l),className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4"}),"Export"]})]})]}),N&&e.jsx(g,{children:e.jsx(u,{className:"p-4",children:e.jsx(Fe,{filters:a,onFiltersChange:h})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(g,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Revenue"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",((i=x==null?void 0:x.totalRevenue)==null?void 0:i.toLocaleString())||"0"]})]}),e.jsx(Z,{className:"w-8 h-8 text-green-600"})]})})}),e.jsx(g,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Management Fees"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",((r=x==null?void 0:x.managementFeeEarned)==null?void 0:r.toLocaleString())||"0"]})]}),e.jsx(Q,{className:"w-8 h-8 text-blue-600"})]})})}),e.jsx(g,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Owner Payouts"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",((j=x==null?void 0:x.ownerPayout)==null?void 0:j.toLocaleString())||"0"]})]}),e.jsx(oe,{className:"w-8 h-8 text-purple-600"})]})})}),e.jsx(g,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Company Retention"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",((n=x==null?void 0:x.companyRetention)==null?void 0:n.toLocaleString())||"0"]})]}),e.jsx(_,{className:"w-8 h-8 text-orange-600"})]})})})]}),e.jsx(g,{children:e.jsx(u,{className:"p-0",children:e.jsxs(Ae,{value:l,onValueChange:o,children:[e.jsx(v,{className:"pb-4",children:e.jsxs($e,{className:"grid w-full grid-cols-6",children:[e.jsxs(E,{value:"owner-payouts",className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Owner Payouts"]}),e.jsxs(E,{value:"pm-earnings",className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4"}),"PM Earnings"]}),e.jsxs(E,{value:"agent-referral",className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"Referral"]}),e.jsxs(E,{value:"agent-retail",className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"Retail"]}),e.jsxs(E,{value:"staff-wages",className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Staff Wages"]}),e.jsxs(E,{value:"settings",className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),"Settings"]})]})}),e.jsxs("div",{className:"px-6 pb-6",children:[e.jsx(B,{value:"owner-payouts",children:e.jsx(Oe,{filters:a})}),e.jsx(B,{value:"pm-earnings",children:e.jsx(qe,{filters:a})}),e.jsx(B,{value:"agent-referral",children:e.jsx(Ee,{filters:a})}),e.jsx(B,{value:"agent-retail",children:e.jsx(Be,{filters:a})}),e.jsx(B,{value:"staff-wages",children:e.jsx(Ue,{filters:a})}),e.jsx(B,{value:"settings",children:e.jsx(We,{})})]})]})})})]})}export{Ke as default};
