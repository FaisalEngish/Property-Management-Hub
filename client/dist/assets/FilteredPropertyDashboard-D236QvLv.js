import{r as q,u as k,j as e,C as N,l as H,b,c as v,F as J,B as I,d as $,a as y,aq as R,I as Q,S as C,e as A,f as F,g as P,h as x,X,O as E,s as W,ao as G,ar as K,as as z,t as Y,v as Z,w as D,x as L,N as _,at as ee,au as se,av as te,p as ae,m as le,aj as re}from"./index-FvzW7A1h.js";function ne({filters:a,onFiltersChange:t,className:c,showFilters:i={property:!0,owner:!0,portfolioManager:!0,area:!0,bedrooms:!0,status:!0,search:!0},placeholder:f="Search..."}){var l,n;const[m,o]=q.useState(!1),{data:h=[]}=k({queryKey:["/api/properties"]}),{data:w=[]}=k({queryKey:["/api/users"]}),d=w.filter(s=>s.role==="owner"),u=w.filter(s=>s.role==="portfolio-manager"),S=[...new Set(h.map(s=>{var r,p;return(p=(r=s.address)==null?void 0:r.split(",").pop())==null?void 0:p.trim()}).filter(Boolean))],M=[...new Set(h.map(s=>s.bedrooms).filter(Boolean))].sort((s,r)=>s-r),j=(s,r)=>{const p={...a};r==="all"||r===""||r===void 0?delete p[s]:p[s]=r,t(p)},B=()=>{t({})},g=()=>Object.keys(a).length,O=s=>{const r=a[s];if(!r)return"All";switch(s){case"propertyId":const p=h.find(T=>T.id===r);return(p==null?void 0:p.name)||"Unknown Property";case"ownerId":const V=d.find(T=>T.id===r);return V?`${V.firstName} ${V.lastName}`:"Unknown Owner";case"portfolioManagerId":const U=u.find(T=>T.id===r);return U?`${U.firstName} ${U.lastName}`:"Unknown PM";case"bedroomCount":return`${r} bed${r!==1?"s":""}`;case"propertyStatus":return r.charAt(0).toUpperCase()+r.slice(1);default:return r}};return e.jsxs(N,{className:H("mb-6",c),children:[e.jsx(b,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(v,{className:"text-base flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),"Filters",g()>0&&e.jsxs(I,{variant:"secondary",className:"text-xs",children:[g()," active"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[g()>0&&e.jsx($,{variant:"ghost",size:"sm",onClick:B,className:"text-xs",children:"Clear All"}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>o(!m),children:m?"Collapse":"Expand"})]})]})}),e.jsxs(y,{className:"pt-0",children:[i.search&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(Q,{placeholder:f,value:a.searchTerm||"",onChange:s=>j("searchTerm",s.target.value),className:"pl-10"})]})}),m&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[i.property&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Property"}),e.jsxs(C,{value:((l=a.propertyId)==null?void 0:l.toString())||"all",onValueChange:s=>j("propertyId",s==="all"?void 0:parseInt(s)),children:[e.jsx(A,{className:"h-8 text-xs",children:e.jsx(F,{placeholder:"All Properties"})}),e.jsxs(P,{children:[e.jsx(x,{value:"all",children:"All Properties"}),h.map(s=>e.jsx(x,{value:s.id.toString(),children:s.name},s.id))]})]})]}),i.owner&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Owner"}),e.jsxs(C,{value:a.ownerId||"all",onValueChange:s=>j("ownerId",s==="all"?void 0:s),children:[e.jsx(A,{className:"h-8 text-xs",children:e.jsx(F,{placeholder:"All Owners"})}),e.jsxs(P,{children:[e.jsx(x,{value:"all",children:"All Owners"}),d.map(s=>e.jsxs(x,{value:s.id,children:[s.firstName," ",s.lastName]},s.id))]})]})]}),i.portfolioManager&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Portfolio Manager"}),e.jsxs(C,{value:a.portfolioManagerId||"all",onValueChange:s=>j("portfolioManagerId",s==="all"?void 0:s),children:[e.jsx(A,{className:"h-8 text-xs",children:e.jsx(F,{placeholder:"All PMs"})}),e.jsxs(P,{children:[e.jsx(x,{value:"all",children:"All Portfolio Managers"}),u.map(s=>e.jsxs(x,{value:s.id,children:[s.firstName," ",s.lastName]},s.id))]})]})]}),i.area&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Area"}),e.jsxs(C,{value:a.area||"all",onValueChange:s=>j("area",s==="all"?void 0:s),children:[e.jsx(A,{className:"h-8 text-xs",children:e.jsx(F,{placeholder:"All Areas"})}),e.jsxs(P,{children:[e.jsx(x,{value:"all",children:"All Areas"}),S.map(s=>e.jsx(x,{value:s,children:s},s))]})]})]}),i.bedrooms&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Bedrooms"}),e.jsxs(C,{value:((n=a.bedroomCount)==null?void 0:n.toString())||"all",onValueChange:s=>j("bedroomCount",s==="all"?void 0:parseInt(s)),children:[e.jsx(A,{className:"h-8 text-xs",children:e.jsx(F,{placeholder:"Any"})}),e.jsxs(P,{children:[e.jsx(x,{value:"all",children:"Any"}),M.map(s=>e.jsxs(x,{value:s.toString(),children:[s," bed",s!==1?"s":""]},s))]})]})]}),i.status&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Status"}),e.jsxs(C,{value:a.propertyStatus||"all",onValueChange:s=>j("propertyStatus",s==="all"?void 0:s),children:[e.jsx(A,{className:"h-8 text-xs",children:e.jsx(F,{placeholder:"All"})}),e.jsxs(P,{children:[e.jsx(x,{value:"all",children:"All"}),e.jsx(x,{value:"active",children:"Active"}),e.jsx(x,{value:"inactive",children:"Inactive"})]})]})]})]}),g()>0&&e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Active filters:"}),Object.entries(a).map(([s,r])=>e.jsxs(I,{variant:"secondary",className:"text-xs flex items-center gap-1",children:[O(s),e.jsx(X,{className:"h-3 w-3 cursor-pointer hover:text-destructive",onClick:()=>j(s,void 0)})]},s))]})})]})]})}function ie(a="global-filters"){const[t,c]=q.useState(()=>{if(typeof window>"u")return{};try{const i=localStorage.getItem(a);return i?JSON.parse(i):{}}catch{return{}}});return q.useEffect(()=>{try{localStorage.setItem(a,JSON.stringify(t))}catch{}},[t,a]),[t,c]}function de(a,t,c={}){const{propertyIdField:i="propertyId",ownerIdField:f="ownerId",portfolioManagerIdField:m="portfolioManagerId",areaField:o="area",bedroomCountField:h="bedrooms",statusField:w="status",searchFields:d=["name","title","description"]}=c;return a.filter(u=>{var S;if(t.propertyId&&u[i]!==t.propertyId||t.ownerId&&u[f]!==t.ownerId||t.portfolioManagerId&&u[m]!==t.portfolioManagerId||t.area&&!((S=u[o])!=null&&S.includes(t.area))||t.bedroomCount&&u[h]!==t.bedroomCount||t.propertyStatus&&u[w]!==t.propertyStatus)return!1;if(t.searchTerm){const M=t.searchTerm.toLowerCase();if(!d.some(B=>{var g;return(g=u[B])==null?void 0:g.toString().toLowerCase().includes(M)}))return!1}return!0})}function ue(){const[a,t]=ie("property-dashboard-filters"),{data:c,isLoading:i}=k({queryKey:["/api/properties"]}),{data:f=[]}=k({queryKey:["/api/maintenance-issues"]}),{data:m=[]}=k({queryKey:["/api/utility-bills"]}),{data:o}=k({queryKey:["/api/bookings"]}),h=Array.isArray(c)?c:(c==null?void 0:c.properties)||[],w=Array.isArray(o)?o:(o==null?void 0:o.bookings)||[],d=de(h,a,{propertyIdField:"id",ownerIdField:"ownerId",portfolioManagerIdField:"portfolioManagerId",areaField:"address",bedroomCountField:"bedrooms",statusField:"status",searchFields:["name","address","description"]}),u=d.filter(l=>l.status==="active").length,S=d.filter(l=>l.status==="inactive").length,M=d.reduce((l,n)=>l+(n.capacity||0),0),j=d.length>0?d.reduce((l,n)=>l+(n.rating||4.5),0)/d.length:0,B=l=>f.filter(n=>n.propertyId===l),g=l=>m.filter(n=>n.propertyId===l&&n.paymentStatus==="pending"),O=l=>{const n=new Date;return w.filter(s=>s.propertyId===l&&new Date(s.checkOut)>=n)};return i?e.jsx("div",{className:"min-h-screen flex bg-background",children:e.jsxs("div",{className:"flex-1 flex flex-col lg:ml-0",children:[e.jsx(E,{title:"Property Dashboard"}),e.jsx("main",{className:"flex-1 overflow-auto p-6",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]})}):e.jsx("div",{className:"min-h-screen flex bg-background",children:e.jsxs("div",{className:"flex-1 flex flex-col lg:ml-0",children:[e.jsx(E,{title:"Property Dashboard"}),e.jsxs("main",{className:"flex-1 overflow-auto p-6",children:[e.jsx(ne,{filters:a,onFiltersChange:t,placeholder:"Search properties...",showFilters:{property:!0,owner:!0,portfolioManager:!0,area:!0,bedrooms:!0,status:!0,search:!0}}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[e.jsxs(N,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium",children:"Active Properties"}),e.jsx(W,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(y,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:u}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[S," inactive"]})]})]}),e.jsxs(N,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium",children:"Total Capacity"}),e.jsx(G,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(y,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:M}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"guests across all properties"})]})]}),e.jsxs(N,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium",children:"Average Rating"}),e.jsx(K,{className:"h-4 w-4 text-yellow-600"})]}),e.jsxs(y,{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:j.toFixed(1)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"out of 5.0 stars"})]})]}),e.jsxs(N,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium",children:"Open Issues"}),e.jsx(z,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(y,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:f.filter(l=>l.status==="open").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"maintenance issues"})]})]})]}),e.jsxs(Y,{defaultValue:"grid",className:"space-y-4",children:[e.jsxs(Z,{children:[e.jsx(D,{value:"grid",children:"Grid View"}),e.jsx(D,{value:"list",children:"List View"}),e.jsx(D,{value:"maintenance",children:"Maintenance Issues"}),e.jsx(D,{value:"utilities",children:"Utility Bills"})]}),e.jsx(L,{value:"grid",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[d.map(l=>e.jsx(ce,{property:l,maintenanceIssues:B(l.id),utilityBills:g(l.id),bookings:O(l.id)},l.id)),d.length===0&&e.jsx("div",{className:"col-span-full text-center py-12 text-muted-foreground",children:"No properties found with current filters"})]})}),e.jsx(L,{value:"list",children:e.jsx(oe,{properties:d})}),e.jsx(L,{value:"maintenance",children:e.jsx(xe,{issues:f.filter(l=>d.some(n=>n.id===l.propertyId))})}),e.jsx(L,{value:"utilities",children:e.jsx(me,{bills:m.filter(l=>d.some(n=>n.id===l.propertyId))})})]})]})]})})}function ce({property:a,maintenanceIssues:t,utilityBills:c,bookings:i}){const[,f]=_(),m=t.filter(w=>w.status==="open").length,o=c.length,h=i.length;return e.jsxs(N,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(b,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(v,{className:"text-lg",children:a.name}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground mt-1",children:[e.jsx(ee,{className:"h-3 w-3"}),a.address]})]}),e.jsx(I,{variant:a.status==="active"?"default":"secondary",children:a.status})]})}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:[a.bedrooms," beds"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:[a.bathrooms," baths"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:[a.capacity," guests"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4 text-yellow-500"}),e.jsx("span",{className:"text-sm",children:a.rating||4.5})]})]}),e.jsxs("div",{className:"space-y-2",children:[m>0&&e.jsx("div",{className:"flex items-center justify-between p-2 bg-red-50 dark:bg-red-950 rounded-md",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4 text-red-600"}),e.jsxs("span",{className:"text-sm text-red-700 dark:text-red-300",children:[m," open issue",m!==1?"s":""]})]})}),o>0&&e.jsx("div",{className:"flex items-center justify-between p-2 bg-yellow-50 dark:bg-yellow-950 rounded-md",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4 text-yellow-600"}),e.jsxs("span",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:[o," pending bill",o!==1?"s":""]})]})}),h>0&&e.jsx("div",{className:"flex items-center justify-between p-2 bg-green-50 dark:bg-green-950 rounded-md",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{className:"text-sm text-green-700 dark:text-green-300",children:[h," upcoming booking",h!==1?"s":""]})]})})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs($,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>f(`/property/${a.id}`),children:[e.jsx(re,{className:"h-4 w-4 mr-1"}),"Manage"]})})]})]})}function oe({properties:a}){return e.jsxs(N,{children:[e.jsx(b,{children:e.jsx(v,{children:"Properties List"})}),e.jsx(y,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Name"}),e.jsx("th",{className:"text-left p-2",children:"Location"}),e.jsx("th",{className:"text-left p-2",children:"Bedrooms"}),e.jsx("th",{className:"text-left p-2",children:"Capacity"}),e.jsx("th",{className:"text-left p-2",children:"Rating"}),e.jsx("th",{className:"text-left p-2",children:"Status"})]})}),e.jsx("tbody",{children:a.map(t=>e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"p-2 font-medium",children:t.name}),e.jsx("td",{className:"p-2 text-sm text-muted-foreground",children:t.address}),e.jsx("td",{className:"p-2 text-sm",children:t.bedrooms}),e.jsx("td",{className:"p-2 text-sm",children:t.capacity}),e.jsx("td",{className:"p-2 text-sm",children:t.rating||4.5}),e.jsx("td",{className:"p-2",children:e.jsx(I,{variant:t.status==="active"?"default":"secondary",children:t.status})})]},t.id))})]})})})]})}function xe({issues:a}){return e.jsxs(N,{children:[e.jsx(b,{children:e.jsx(v,{children:"Maintenance Issues"})}),e.jsx(y,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Property"}),e.jsx("th",{className:"text-left p-2",children:"Issue"}),e.jsx("th",{className:"text-left p-2",children:"Priority"}),e.jsx("th",{className:"text-left p-2",children:"Status"}),e.jsx("th",{className:"text-left p-2",children:"Date"})]})}),e.jsx("tbody",{children:a.map(t=>e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"p-2 font-medium",children:t.propertyName}),e.jsx("td",{className:"p-2 text-sm",children:t.description}),e.jsx("td",{className:"p-2",children:e.jsx(I,{variant:t.urgency==="High"?"destructive":"secondary",children:t.urgency})}),e.jsx("td",{className:"p-2",children:e.jsx(I,{variant:t.status==="open"?"destructive":"default",children:t.status})}),e.jsx("td",{className:"p-2 text-sm",children:new Date(t.reportedDate).toLocaleDateString()})]},t.id))})]})})})]})}function me({bills:a}){return e.jsxs(N,{children:[e.jsx(b,{children:e.jsx(v,{children:"Utility Bills"})}),e.jsx(y,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Property"}),e.jsx("th",{className:"text-left p-2",children:"Bill Type"}),e.jsx("th",{className:"text-right p-2",children:"Amount"}),e.jsx("th",{className:"text-left p-2",children:"Due Date"}),e.jsx("th",{className:"text-left p-2",children:"Status"})]})}),e.jsx("tbody",{children:a.map(t=>e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"p-2 font-medium",children:t.propertyName}),e.jsx("td",{className:"p-2 text-sm",children:t.billType}),e.jsxs("td",{className:"p-2 text-sm text-right font-medium",children:["à¸¿",parseFloat(t.amount).toLocaleString()]}),e.jsx("td",{className:"p-2 text-sm",children:new Date(t.dueDate).toLocaleDateString()}),e.jsx("td",{className:"p-2",children:e.jsx(I,{variant:t.paymentStatus==="paid"?"default":"destructive",children:t.paymentStatus})})]},t.id))})]})})})]})}export{ue as default};
