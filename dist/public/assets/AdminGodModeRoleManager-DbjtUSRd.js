import{ad as je,ae as fe,u as G,af as ve,ag as A,aE as we,ah as O,q as ie,aj as y,aF as re,aG as te,o as H,aH as M,aI as Ne,a5 as ye,am as j,aJ as be,aK as Ce,ab as Pe,aL as Se,j as e,aM as V,C as l,a as c,a1 as f,a7 as ne,d as v,r as Ae,s as Re,t as R,v as k,b as I,c as T,aw as ke,aN as E,L as Q,ao as K,I as z,S as _,e as W,f as J,g as Z,h as X,Q as Y,U as ee,V as h,W as o,Z as se,_ as r,B as w,aB as ae,al as Ie,aO as Te,aP as Ee,aQ as Me}from"./index-C6ci-s2z.js";import{r as g}from"./vendor-DazevGLP.js";import"./utils-Bh8xMpiq.js";const n=[{id:"admin",name:"Admin",description:"Full system access",color:"bg-red-500",icon:V},{id:"portfolio-manager",name:"Portfolio Manager",description:"Manages multiple properties",color:"bg-purple-500",icon:M},{id:"owner",name:"Owner",description:"Property owner access",color:"bg-blue-500",icon:ie},{id:"retail-agent",name:"Retail Agent",description:"Books properties for guests",color:"bg-green-500",icon:ne},{id:"referral-agent",name:"Referral Agent",description:"Refers properties to guests",color:"bg-yellow-500",icon:j},{id:"staff",name:"Staff",description:"Property maintenance staff",color:"bg-gray-500",icon:te},{id:"guest",name:"Guest",description:"Property guest access",color:"bg-pink-500",icon:re}],N=[{id:"dashboard-view",module:"Dashboard",feature:"View Dashboard",description:"Access main dashboard",icon:we,category:"Core"},{id:"dashboard-edit",module:"Dashboard",feature:"Edit Dashboard",description:"Customize dashboard layout",icon:O,category:"Core"},{id:"properties-view",module:"Properties",feature:"View Properties",description:"View property listings",icon:ie,category:"Property"},{id:"properties-edit",module:"Properties",feature:"Edit Properties",description:"Modify property details",icon:y,category:"Property"},{id:"checkin-tracker",module:"Check-in Tracker",feature:"Guest Check-in",description:"Track guest arrivals",icon:re,category:"Property"},{id:"maintenance-system",module:"Maintenance",feature:"Maintenance System",description:"Manage property maintenance",icon:te,category:"Property"},{id:"finances-view",module:"Finances",feature:"View Finances",description:"View financial reports",icon:H,category:"Financial"},{id:"finances-edit",module:"Finances",feature:"Edit Finances",description:"Modify financial records",icon:y,category:"Financial"},{id:"booking-income",module:"Booking Income",feature:"Booking Revenue",description:"Track booking income",icon:M,category:"Financial"},{id:"payouts",module:"Payouts",feature:"Process Payouts",description:"Handle commission payouts",icon:H,category:"Financial"},{id:"tasks-view",module:"Tasks",feature:"View Tasks",description:"View task assignments",icon:Ne,category:"Tasks"},{id:"tasks-edit",module:"Tasks",feature:"Edit Tasks",description:"Create and modify tasks",icon:y,category:"Tasks"},{id:"auto-scheduling",module:"Auto Scheduling",feature:"Automated Rules",description:"Manage recurring tasks",icon:ye,category:"Tasks"},{id:"user-management",module:"User Management",feature:"Manage Users",description:"Create and manage users",icon:j,category:"Admin"},{id:"system-settings",module:"System Settings",feature:"System Config",description:"Configure system settings",icon:O,category:"Admin"},{id:"ai-notifications",module:"AI Notifications",feature:"Smart Alerts",description:"AI-powered notifications",icon:be,category:"Admin"},{id:"activity-logs",module:"Activity Logs",feature:"Audit Trail",description:"View system activity",icon:Ce,category:"Admin"},{id:"smart-pricing",module:"Smart Pricing",feature:"AI Pricing",description:"Dynamic pricing tools",icon:Pe,category:"Advanced"},{id:"performance-toolkit",module:"Performance",feature:"Analytics",description:"Performance insights",icon:M,category:"Advanced"},{id:"inventory-management",module:"Inventory",feature:"Stock Management",description:"Track inventory items",icon:Se,category:"Advanced"}],p=[{id:"demo-admin",name:"Admin User",email:"admin@test.com",role:"admin",lastLogin:"2025-01-28 17:30",status:"active"},{id:"demo-pm",name:"Portfolio Manager",email:"manager@test.com",role:"portfolio-manager",lastLogin:"2025-01-28 16:45",status:"active"},{id:"demo-owner",name:"Property Owner",email:"owner@test.com",role:"owner",lastLogin:"2025-01-28 15:20",status:"active"},{id:"demo-staff",name:"Staff Member",email:"staff@test.com",role:"staff",lastLogin:"2025-01-28 14:15",status:"active"},{id:"demo-retail-agent",name:"Retail Agent",email:"retail@test.com",role:"retail-agent",lastLogin:"2025-01-28 13:30",status:"active"},{id:"demo-referral-agent",name:"Referral Agent",email:"referral@test.com",role:"referral-agent",lastLogin:"2025-01-28 12:45",status:"active"}];function Be(){const{toast:x}=je(),U=fe(),[Ve,Ue]=g.useState("admin"),[b,le]=g.useState(""),[C,ce]=g.useState("All"),[m,L]=g.useState(null),[de,oe]=g.useState([{roleId:"admin",permissionId:"dashboard-view",canView:!0,canEdit:!0},{roleId:"admin",permissionId:"properties-view",canView:!0,canEdit:!0},{roleId:"admin",permissionId:"finances-view",canView:!0,canEdit:!0},{roleId:"portfolio-manager",permissionId:"dashboard-view",canView:!0,canEdit:!1},{roleId:"portfolio-manager",permissionId:"properties-view",canView:!0,canEdit:!0},{roleId:"portfolio-manager",permissionId:"finances-view",canView:!0,canEdit:!1},{roleId:"owner",permissionId:"dashboard-view",canView:!0,canEdit:!1},{roleId:"owner",permissionId:"properties-view",canView:!0,canEdit:!1},{roleId:"owner",permissionId:"finances-view",canView:!0,canEdit:!1}]),{data:me=p,isLoading:F}=G({queryKey:["/api/user-management/users"],queryFn:async()=>{try{return(await A("GET","/api/user-management/users")).json()}catch(s){return console.error("Failed to fetch users:",s),p}}}),{data:P={totalUsers:0,activeUsers:0,byRole:{}}}=G({queryKey:["/api/user-management/stats"],queryFn:async()=>{try{return(await A("GET","/api/user-management/stats")).json()}catch(s){return console.error("Failed to fetch user stats:",s),{totalUsers:p.length,activeUsers:p.filter(i=>i.status==="active").length,byRole:p.reduce((i,a)=>(i[a.role]=(i[a.role]||0)+1,i),{})}}}}),$=ve({mutationFn:async({userId:s,role:i})=>(await A("PUT",`/api/user-management/users/${s}/role`,{primaryRole:i})).json(),onSuccess:()=>{U.invalidateQueries({queryKey:["/api/user-management/users"]}),U.invalidateQueries({queryKey:["/api/user-management/stats"]}),x({title:"Role Updated",description:"User role has been updated successfully"})},onError:s=>{console.error("Failed to update user role:",s),x({title:"Error",description:"Failed to update user role",variant:"destructive"})}}),xe=["All",...Array.from(new Set(N.map(s=>s.category)))],ue=N.filter(s=>{const i=s.feature.toLowerCase().includes(b.toLowerCase())||s.module.toLowerCase().includes(b.toLowerCase()),a=C==="All"||s.category===C;return i&&a}),S=(s,i)=>de.find(a=>a.roleId===s&&a.permissionId===i),q=(s,i,a,t)=>{oe(u=>u.find(d=>d.roleId===s&&d.permissionId===i)?u.map(d=>d.roleId===s&&d.permissionId===i?{...d,[a==="view"?"canView":"canEdit"]:t}:d):[...u,{roleId:s,permissionId:i,canView:a==="view"?t:!1,canEdit:a==="edit"?t:!1}]),x({title:"Permission Updated",description:`${a==="view"?"View":"Edit"} access ${t?"granted":"revoked"} for ${n.find(u=>u.id===s)?.name}`})},B=s=>{L(s),x({title:"Preview Mode Active",description:`Now previewing as ${n.find(i=>i.id===s)?.name}`,variant:"default"})},D=()=>{L(null),x({title:"Preview Mode Disabled",description:"Returned to Admin view"})},he=s=>{B(s.role)},ge=s=>n.find(a=>a.id===s)?.icon||j,pe=s=>n.find(a=>a.id===s)?.color||"bg-gray-500";return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(V,{className:"h-8 w-8 text-yellow-500"}),"God Mode & Role Manager"]}),e.jsx("p",{className:"text-muted-foreground",children:"Complete admin control over user roles and permissions"})]}),m&&e.jsx(l,{className:"border-2 border-orange-500",children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(f,{className:"h-5 w-5 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Preview Mode Active"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Viewing as: ",n.find(s=>s.id===m)?.name]})]}),e.jsx(v,{variant:"outline",size:"sm",onClick:D,children:"Exit Preview"})]})})})]}),e.jsxs(Ae,{defaultValue:"permissions",className:"space-y-6",children:[e.jsxs(Re,{className:"grid w-full grid-cols-3",children:[e.jsx(R,{value:"permissions",children:"Role Permissions"}),e.jsx(R,{value:"preview",children:"Preview Roles"}),e.jsx(R,{value:"users",children:"Demo Users"})]}),e.jsx(k,{value:"permissions",className:"space-y-6",children:e.jsxs(l,{children:[e.jsxs(I,{children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5"}),"Role Access Control Panel"]}),e.jsx(E,{children:"Manage view and edit permissions for each role across all system modules"})]}),e.jsxs(c,{children:[e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(Q,{htmlFor:"search",children:"Search Permissions"}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(z,{id:"search",placeholder:"Search modules or features...",value:b,onChange:s=>le(s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"category",children:"Category"}),e.jsxs(_,{value:C,onValueChange:ce,children:[e.jsx(W,{id:"category",children:e.jsx(J,{})}),e.jsx(Z,{children:xe.map(s=>e.jsx(X,{value:s,children:s},s))})]})]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(Y,{children:[e.jsx(ee,{children:e.jsxs(h,{children:[e.jsx(o,{className:"w-[300px]",children:"Feature"}),n.map(s=>e.jsx(o,{className:"text-center min-w-[120px]",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(s.icon,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:s.name})]})},s.id))]})}),e.jsx(se,{children:ue.map(s=>e.jsxs(h,{children:[e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s.icon,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.feature}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.module})]}),e.jsx(w,{variant:"outline",className:"text-xs",children:s.category})]})}),n.map(i=>{const a=S(i.id,s.id);return e.jsx(r,{className:"text-center",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(f,{className:"h-3 w-3"}),e.jsx(ae,{checked:a?.canView||!1,onCheckedChange:t=>q(i.id,s.id,"view",t)})]}),e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(y,{className:"h-3 w-3"}),e.jsx(ae,{checked:a?.canEdit||!1,onCheckedChange:t=>q(i.id,s.id,"edit",t)})]})]})},i.id)})]},s.id))})]})})]})]})}),e.jsx(k,{value:"preview",className:"space-y-6",children:e.jsxs(l,{children:[e.jsxs(I,{children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(f,{className:"h-5 w-5"}),"Role Preview System"]}),e.jsx(E,{children:"Preview the system interface from any role's perspective"})]}),e.jsx(c,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:n.map(s=>{const i=s.icon;return e.jsx(l,{className:`cursor-pointer transition-all hover:shadow-lg ${m===s.id?"ring-2 ring-blue-500":""}`,children:e.jsxs(c,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:`p-2 rounded-lg ${s.color} text-white`,children:e.jsx(i,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("p",{className:"text-sm font-medium",children:"Accessible Features:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[N.slice(0,6).map(a=>S(s.id,a.id)?.canView?e.jsx(w,{variant:"secondary",className:"text-xs",children:a.module},a.id):null),e.jsxs(w,{variant:"outline",className:"text-xs",children:["+",N.filter(a=>S(s.id,a.id)?.canView).length-6," more"]})]})]}),e.jsx(v,{className:"w-full",variant:m===s.id?"default":"outline",onClick:()=>m===s.id?D():B(s.id),children:m===s.id?"Exit Preview":"Preview Role"})]})},s.id)})})})]})}),e.jsx(k,{value:"users",className:"space-y-6",children:e.jsxs(l,{children:[e.jsxs(I,{children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(j,{className:"h-5 w-5"}),"User Management System",F&&e.jsx("div",{className:"h-4 w-4 border-2 border-gray-300 border-t-blue-500 rounded-full animate-spin"})]}),e.jsx(E,{children:"Manage user accounts, roles, and permissions with real-time API integration"})]}),e.jsxs(c,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(l,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold",children:P.totalUsers})]})]})})}),e.jsx(l,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active Users"}),e.jsx("p",{className:"text-2xl font-bold",children:P.activeUsers})]})]})})}),e.jsx(l,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5 text-purple-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Roles Configured"}),e.jsx("p",{className:"text-2xl font-bold",children:Object.keys(P.byRole||{}).length})]})]})})})]}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("div",{className:"flex gap-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:"Search users...",className:"pl-10 w-64"})]})}),e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-4 w-4"}),"Create Demo User"]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(Y,{children:[e.jsx(ee,{children:e.jsxs(h,{children:[e.jsx(o,{children:"User"}),e.jsx(o,{children:"Role"}),e.jsx(o,{children:"Last Login"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Actions"})]})}),e.jsx(se,{children:F?Array(5).fill(0).map((s,i)=>e.jsxs(h,{children:[e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 bg-gray-200 rounded-full animate-pulse"}),e.jsxs("div",{children:[e.jsx("div",{className:"h-4 w-24 bg-gray-200 rounded animate-pulse mb-1"}),e.jsx("div",{className:"h-3 w-32 bg-gray-200 rounded animate-pulse"})]})]})}),e.jsx(r,{children:e.jsx("div",{className:"h-4 w-20 bg-gray-200 rounded animate-pulse"})}),e.jsx(r,{children:e.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded animate-pulse"})}),e.jsx(r,{children:e.jsx("div",{className:"h-4 w-12 bg-gray-200 rounded animate-pulse"})}),e.jsx(r,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"h-8 w-16 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-8 w-16 bg-gray-200 rounded animate-pulse"})]})})]},i)):me.map(s=>{const i=ge(s.primaryRole||s.role);return e.jsxs(h,{children:[e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(Te,{className:"h-8 w-8",children:[e.jsx(Ee,{src:s.profileImageUrl}),e.jsx(Me,{children:s.firstName&&s.lastName?`${s.firstName[0]}${s.lastName[0]}`:s.email?.[0]?.toUpperCase()||"?"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.email}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email})]})]})}),e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-1 rounded ${pe(s.primaryRole||s.role)} text-white`,children:e.jsx(i,{className:"h-3 w-3"})}),e.jsx("span",{className:"capitalize",children:(s.primaryRole||s.role)?.replace("-"," ")||"No Role"})]})}),e.jsx(r,{className:"text-sm text-muted-foreground",children:s.lastLogin||"Never"}),e.jsx(r,{children:e.jsx(w,{variant:s.isActive!==!1?"default":"secondary",children:s.isActive!==!1?"active":"inactive"})}),e.jsx(r,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>he({id:s.id,name:s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.email,email:s.email,role:s.primaryRole||s.role,lastLogin:s.lastLogin||"Never",status:s.isActive!==!1?"active":"inactive"}),className:"flex items-center gap-1",children:[e.jsx(f,{className:"h-3 w-3"}),"Preview"]}),e.jsxs(_,{value:s.primaryRole||s.role||"",onValueChange:a=>$.mutate({userId:s.id,role:a}),disabled:$.isPending,children:[e.jsx(W,{className:"w-32",children:e.jsx(J,{placeholder:"Role"})}),e.jsx(Z,{children:n.map(a=>e.jsx(X,{value:a.id,children:a.name},a.id))})]})]})})]},s.id)})})]})})]})]})})]})]})}export{Be as default};
