import{O as ie,u as k,j as e,d as N,X as le,L,P as X,i as Z,l as W,m as ee,n as se,S as V,e as _,f as H,g as Y,h as R,C as h,b as f,c as v,o as J,a as j,Q as A,U as $,V as S,W as l,Z as T,_ as d,$ as de,a0 as ce,a1 as ue,a2 as oe,a3 as xe,a4 as me,B as y,a5 as P,a6 as B,a7 as z,a8 as K,T as Q,a9 as G,aa as ae,ab as pe,ac as Ne,ad as fe,ae as ve,af as ye,ag as be,ah as he,ai as we,aj as Se,I as F,ak as ke,al as Pe,F as Ce,D as De,am as te,r as Me,s as Re,t as O,v as q}from"./index-C6ci-s2z.js";import{r as E}from"./vendor-DazevGLP.js";import{o as ne}from"./utils-Bh8xMpiq.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=ie("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=ie("UsersRound",[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]]);function Le({filters:r,onFiltersChange:c}){const[t,m]=E.useState(r),{data:u=[]}=k({queryKey:["/api/properties"],select:s=>s||[]}),{data:g=[]}=k({queryKey:["/api/users"],select:s=>s||[]}),p=()=>{c(t)},n=()=>{const s={};m(s),c(s)},a=g.filter(s=>s.role==="portfolio-manager"||s.role==="admin"),i=g.filter(s=>s.role==="retail-agent"||s.role==="referral-agent");return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Filters"}),e.jsxs(N,{variant:"outline",size:"sm",onClick:n,children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Clear All"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{children:"Start Date"}),e.jsxs(X,{children:[e.jsx(Z,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),t.startDate?ne(t.startDate,"MMM dd, yyyy"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(ee,{className:"w-auto p-0",children:e.jsx(se,{mode:"single",selected:t.startDate,onSelect:s=>m({...t,startDate:s}),initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{children:"End Date"}),e.jsxs(X,{children:[e.jsx(Z,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),t.endDate?ne(t.endDate,"MMM dd, yyyy"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(ee,{className:"w-auto p-0",children:e.jsx(se,{mode:"single",selected:t.endDate,onSelect:s=>m({...t,endDate:s}),initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{children:"Properties"}),e.jsxs(V,{value:t.propertyIds?.join(",")||"",onValueChange:s=>{m(s?{...t,propertyIds:s.split(",").map(Number)}:{...t,propertyIds:void 0})},children:[e.jsx(_,{children:e.jsx(H,{placeholder:"All Properties"})}),e.jsxs(Y,{children:[e.jsx(R,{value:"",children:"All Properties"}),u.map(s=>e.jsx(R,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{children:"Stakeholders"}),e.jsxs(V,{value:t.stakeholderIds?.join(",")||"",onValueChange:s=>{m(s?{...t,stakeholderIds:s.split(",")}:{...t,stakeholderIds:void 0})},children:[e.jsx(_,{children:e.jsx(H,{placeholder:"All Stakeholders"})}),e.jsxs(Y,{children:[e.jsx(R,{value:"",children:"All Stakeholders"}),a.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(R,{value:"",disabled:!0,children:"Property Managers"}),a.map(s=>e.jsxs(R,{value:s.id,children:[s.firstName," ",s.lastName]},s.id))]}),i.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(R,{value:"",disabled:!0,children:"Agents"}),i.map(s=>e.jsxs(R,{value:s.id,children:[s.firstName," ",s.lastName]},s.id))]})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(N,{variant:"outline",size:"sm",onClick:()=>{const s=new Date,o=new Date(s.getFullYear(),s.getMonth(),1);m({...t,startDate:o,endDate:s})},children:"This Month"}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>{const s=new Date,o=new Date(s.getFullYear(),s.getMonth()-1,1),C=new Date(s.getFullYear(),s.getMonth(),0);m({...t,startDate:o,endDate:C})},children:"Last Month"}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>{const s=new Date,o=new Date(s.getFullYear(),Math.floor(s.getMonth()/3)*3,1);m({...t,startDate:o,endDate:s})},children:"This Quarter"}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>{const s=new Date,o=new Date(s.getFullYear(),0,1);m({...t,startDate:o,endDate:s})},children:"This Year"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(N,{onClick:p,children:"Apply Filters"})})]})}function Ae({filters:r}){const c=new URLSearchParams;r.startDate&&c.set("startDate",r.startDate.toISOString()),r.endDate&&c.set("endDate",r.endDate.toISOString()),r.propertyIds&&c.set("propertyIds",r.propertyIds.join(",")),r.stakeholderIds&&c.set("ownerIds",r.stakeholderIds.join(","));const{data:t=[],isLoading:m}=k({queryKey:[`/api/admin/finance/owner-payouts?${c}`]}),u=(n,a)=>{console.log("Mark paid:",n,a)},g=n=>{switch(n){case"paid":return e.jsxs(y,{variant:"default",className:"bg-green-100 text-green-800",children:[e.jsx(B,{className:"w-3 h-3 mr-1"}),"Paid"]});case"queued":return e.jsxs(y,{variant:"secondary",children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"Queued"]});default:return e.jsxs(y,{variant:"outline",children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"Pending"]})}};if(m)return e.jsx("div",{className:"animate-pulse space-y-4",children:Array.from({length:5}).map((n,a)=>e.jsx("div",{className:"h-16 bg-gray-200 rounded"},a))});const p=t.reduce((n,a)=>n+a.earnings.net,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(h,{children:[e.jsx(f,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5"}),"Owner Payouts Summary"]})}),e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Payouts Due"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",p.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Number of Owners"}),e.jsx("p",{className:"text-2xl font-bold",children:t.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Properties Involved"}),e.jsx("p",{className:"text-2xl font-bold",children:t.reduce((n,a)=>n+a.properties.length,0)})]})]})})]}),e.jsxs(h,{children:[e.jsx(f,{children:e.jsx(v,{children:"Owner Payouts"})}),e.jsxs(j,{children:[e.jsxs(A,{children:[e.jsx($,{children:e.jsxs(S,{children:[e.jsx(l,{children:"Owner"}),e.jsx(l,{children:"Properties"}),e.jsx(l,{className:"text-right",children:"Gross Revenue"}),e.jsx(l,{className:"text-right",children:"Management Fees"}),e.jsx(l,{className:"text-right",children:"Net Payout"}),e.jsx(l,{children:"Status"}),e.jsx(l,{children:"Actions"})]})}),e.jsx(T,{children:t.map(n=>e.jsxs(S,{children:[e.jsx(d,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:n.stakeholderName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:n.stakeholderId})]})}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-1",children:[n.properties.slice(0,2).map(a=>e.jsx("div",{className:"text-sm",children:a.propertyName},a.propertyId)),n.properties.length>2&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["+",n.properties.length-2," more"]})]})}),e.jsxs(d,{className:"text-right",children:["$",n.earnings.gross.toLocaleString()]}),e.jsxs(d,{className:"text-right",children:["$",n.earnings.deductions.toLocaleString()]}),e.jsxs(d,{className:"text-right font-medium",children:["$",n.earnings.net.toLocaleString()]}),e.jsx(d,{children:g(n.earnings.status)}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(de,{children:[e.jsx(ce,{asChild:!0,children:e.jsx(N,{variant:"outline",size:"sm",children:e.jsx(ue,{className:"w-4 h-4"})})}),e.jsxs(oe,{className:"max-w-2xl",children:[e.jsx(xe,{children:e.jsxs(me,{children:[n.stakeholderName," - Property Breakdown"]})}),e.jsx("div",{className:"space-y-4",children:e.jsxs(A,{children:[e.jsx($,{children:e.jsxs(S,{children:[e.jsx(l,{children:"Property"}),e.jsx(l,{className:"text-right",children:"Revenue"}),e.jsx(l,{className:"text-right",children:"Management Fee"}),e.jsx(l,{className:"text-right",children:"Net Payout"})]})}),e.jsx(T,{children:n.properties.map(a=>e.jsxs(S,{children:[e.jsx(d,{children:a.propertyName}),e.jsxs(d,{className:"text-right",children:["$",a.revenue.toLocaleString()]}),e.jsxs(d,{className:"text-right",children:["$",(a.revenue-a.commission).toLocaleString()]}),e.jsxs(d,{className:"text-right font-medium",children:["$",a.commission.toLocaleString()]})]},a.propertyId))})]})})]})]}),n.earnings.status==="pending"&&e.jsx(N,{size:"sm",onClick:()=>u(n.stakeholderId,n.earnings.net),children:"Mark Paid"})]})})]},n.stakeholderId))})]}),t.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No owner payouts found for the selected period."})]})]})]})}function $e({filters:r}){const c=new URLSearchParams;r.startDate&&c.set("startDate",r.startDate.toISOString()),r.endDate&&c.set("endDate",r.endDate.toISOString()),r.propertyIds&&c.set("propertyIds",r.propertyIds.join(",")),r.stakeholderIds&&c.set("managerIds",r.stakeholderIds.join(","));const{data:t=[],isLoading:m}=k({queryKey:[`/api/admin/finance/pm-earnings?${c}`]}),u=(n,a)=>{console.log("Mark paid:",n,a)},g=n=>{switch(n){case"paid":return e.jsxs(y,{variant:"default",className:"bg-green-100 text-green-800",children:[e.jsx(B,{className:"w-3 h-3 mr-1"}),"Paid"]});case"queued":return e.jsxs(y,{variant:"secondary",children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"Queued"]});default:return e.jsxs(y,{variant:"outline",children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"Pending"]})}};if(m)return e.jsx("div",{className:"animate-pulse space-y-4",children:Array.from({length:5}).map((n,a)=>e.jsx("div",{className:"h-16 bg-gray-200 rounded"},a))});const p=t.reduce((n,a)=>n+a.earnings.net,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(h,{children:[e.jsx(f,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"Property Manager Earnings Summary"]})}),e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total PM Earnings"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",p.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active Managers"}),e.jsx("p",{className:"text-2xl font-bold",children:t.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Properties Managed"}),e.jsx("p",{className:"text-2xl font-bold",children:t.reduce((n,a)=>n+a.properties.length,0)})]})]})})]}),e.jsxs(h,{children:[e.jsx(f,{children:e.jsx(v,{children:"Property Manager Commission Earnings"})}),e.jsxs(j,{children:[e.jsxs(A,{children:[e.jsx($,{children:e.jsxs(S,{children:[e.jsx(l,{children:"Property Manager"}),e.jsx(l,{children:"Properties Managed"}),e.jsx(l,{className:"text-right",children:"Total Revenue Generated"}),e.jsx(l,{className:"text-right",children:"Commission Split"}),e.jsx(l,{className:"text-right",children:"Earnings"}),e.jsx(l,{children:"Status"}),e.jsx(l,{children:"Actions"})]})}),e.jsx(T,{children:t.map(n=>{const a=n.properties.reduce((s,o)=>s+o.revenue,0);return e.jsxs(S,{children:[e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(z,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:n.stakeholderName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Portfolio Manager"})]})]})}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-1",children:[n.properties.slice(0,2).map(s=>e.jsxs("div",{className:"text-sm flex items-center gap-1",children:[e.jsx(K,{className:"w-3 h-3"}),s.propertyName]},s.propertyId)),n.properties.length>2&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["+",n.properties.length-2," more properties"]})]})}),e.jsx(d,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(Q,{className:"w-4 h-4 text-green-600"}),"$",a.toLocaleString()]})}),e.jsx(d,{className:"text-right",children:e.jsxs(y,{variant:"secondary",children:[50,"%"]})}),e.jsxs(d,{className:"text-right font-medium",children:["$",n.earnings.net.toLocaleString()]}),e.jsx(d,{children:g(n.earnings.status)}),e.jsx(d,{children:n.earnings.status==="pending"&&e.jsx(N,{size:"sm",onClick:()=>u(n.stakeholderId,n.earnings.net),children:"Mark Paid"})})]},n.stakeholderId)})})]}),t.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No property manager earnings found for the selected period."})]})]}),t.length>0&&e.jsxs(h,{children:[e.jsx(f,{children:e.jsx(v,{children:"Performance Insights"})}),e.jsx(j,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(n=>{const a=n.properties.reduce((i,s)=>i+s.revenue,0)/n.properties.length;return e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:n.stakeholderName}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Properties:"}),e.jsx("span",{children:n.properties.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Avg Revenue/Property:"}),e.jsxs("span",{children:["$",a.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Commission Rate:"}),e.jsx("span",{children:"50%"})]})]})]},n.stakeholderId)})})})]})]})}function Te({filters:r}){const c=new URLSearchParams;r.startDate&&c.set("startDate",r.startDate.toISOString()),r.endDate&&c.set("endDate",r.endDate.toISOString()),r.stakeholderIds&&c.set("agentIds",r.stakeholderIds.join(","));const{data:t=[],isLoading:m}=k({queryKey:[`/api/admin/finance/agent-referral?${c}`]}),u=(a,i)=>{console.log("Mark paid:",a,i)},g=a=>{switch(a){case"paid":return e.jsxs(y,{variant:"default",className:"bg-green-100 text-green-800",children:[e.jsx(B,{className:"w-3 h-3 mr-1"}),"Paid"]});case"queued":return e.jsxs(y,{variant:"secondary",children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"Queued"]});default:return e.jsxs(y,{variant:"outline",children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"Pending"]})}};if(m)return e.jsx("div",{className:"animate-pulse space-y-4",children:Array.from({length:5}).map((a,i)=>e.jsx("div",{className:"h-16 bg-gray-200 rounded"},i))});const p=t.reduce((a,i)=>a+i.earnings.net,0),n=t.reduce((a,i)=>a+i.properties.length,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(h,{children:[e.jsx(f,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5"}),"Referral Agent Commission Summary"]})}),e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Referral Commissions"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",p.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active Referral Agents"}),e.jsx("p",{className:"text-2xl font-bold",children:t.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Referrals"}),e.jsx("p",{className:"text-2xl font-bold",children:n})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg Commission/Agent"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",t.length>0?Math.round(p/t.length).toLocaleString():"0"]})]})]})})]}),e.jsxs(h,{children:[e.jsx(f,{children:e.jsx(v,{children:"Referral Agent Commissions"})}),e.jsxs(j,{children:[e.jsxs(A,{children:[e.jsx($,{children:e.jsxs(S,{children:[e.jsx(l,{children:"Referral Agent"}),e.jsx(l,{children:"Referrals"}),e.jsx(l,{className:"text-right",children:"Total Referral Value"}),e.jsx(l,{className:"text-right",children:"Commission Rate"}),e.jsx(l,{className:"text-right",children:"Commission Earned"}),e.jsx(l,{children:"Status"}),e.jsx(l,{children:"Actions"})]})}),e.jsx(T,{children:t.map(a=>{const i=a.properties.reduce((o,C)=>o+C.revenue,0);return e.jsxs(S,{children:[e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center",children:e.jsx(re,{className:"w-4 h-4 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.stakeholderName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Referral Agent"})]})]})}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium",children:a.properties.length}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"referrals"})]})}),e.jsx(d,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(Q,{className:"w-4 h-4 text-green-600"}),"$",i.toLocaleString()]})}),e.jsx(d,{className:"text-right",children:e.jsxs(y,{variant:"secondary",children:[5,"%"]})}),e.jsxs(d,{className:"text-right font-medium",children:["$",a.earnings.net.toLocaleString()]}),e.jsx(d,{children:g(a.earnings.status)}),e.jsx(d,{children:a.earnings.status==="pending"&&e.jsx(N,{size:"sm",onClick:()=>u(a.stakeholderId,a.earnings.net),children:"Mark Paid"})})]},a.stakeholderId)})})]}),t.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No referral agent commissions found for the selected period."})]})]}),t.length>0&&e.jsxs(h,{children:[e.jsx(f,{children:e.jsx(v,{children:"Top Referral Performers"})}),e.jsx(j,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.sort((a,i)=>i.earnings.net-a.earnings.net).slice(0,6).map((a,i)=>e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i===0&&e.jsx("div",{className:"w-2 h-2 bg-gold-500 rounded-full"}),i===1&&e.jsx("div",{className:"w-2 h-2 bg-silver-500 rounded-full"}),i===2&&e.jsx("div",{className:"w-2 h-2 bg-bronze-500 rounded-full"}),e.jsx("h4",{className:"font-medium",children:a.stakeholderName})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Referrals:"}),e.jsx("span",{children:a.properties.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Commission:"}),e.jsxs("span",{className:"font-medium",children:["$",a.earnings.net.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Avg/Referral:"}),e.jsxs("span",{children:["$",Math.round(a.earnings.net/a.properties.length).toLocaleString()]})]})]})]},a.stakeholderId))})})]})]})}function Fe({filters:r}){const c=new URLSearchParams;r.startDate&&c.set("startDate",r.startDate.toISOString()),r.endDate&&c.set("endDate",r.endDate.toISOString()),r.stakeholderIds&&c.set("agentIds",r.stakeholderIds.join(","));const{data:t=[],isLoading:m}=k({queryKey:[`/api/admin/finance/agent-retail?${c}`]}),u=(a,i)=>{console.log("Mark paid:",a,i)},g=a=>{switch(a){case"paid":return e.jsxs(y,{variant:"default",className:"bg-green-100 text-green-800",children:[e.jsx(B,{className:"w-3 h-3 mr-1"}),"Paid"]});case"queued":return e.jsxs(y,{variant:"secondary",children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"Queued"]});default:return e.jsxs(y,{variant:"outline",children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"Pending"]})}};if(m)return e.jsx("div",{className:"animate-pulse space-y-4",children:Array.from({length:5}).map((a,i)=>e.jsx("div",{className:"h-16 bg-gray-200 rounded"},i))});const p=t.reduce((a,i)=>a+i.earnings.net,0),n=t.reduce((a,i)=>a+i.properties.length,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(h,{children:[e.jsx(f,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"Retail Agent Commission Summary"]})}),e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Retail Commissions"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",p.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active Retail Agents"}),e.jsx("p",{className:"text-2xl font-bold",children:t.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Direct Bookings"}),e.jsx("p",{className:"text-2xl font-bold",children:n})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg Commission/Agent"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",t.length>0?Math.round(p/t.length).toLocaleString():"0"]})]})]})})]}),e.jsxs(h,{children:[e.jsx(f,{children:e.jsx(v,{children:"Retail Agent Commissions"})}),e.jsxs(j,{children:[e.jsxs(A,{children:[e.jsx($,{children:e.jsxs(S,{children:[e.jsx(l,{children:"Retail Agent"}),e.jsx(l,{children:"Direct Bookings"}),e.jsx(l,{className:"text-right",children:"Total Booking Value"}),e.jsx(l,{className:"text-right",children:"Commission Rate"}),e.jsx(l,{className:"text-right",children:"Commission Earned"}),e.jsx(l,{children:"Status"}),e.jsx(l,{children:"Actions"})]})}),e.jsx(T,{children:t.map(a=>{const i=a.properties.reduce((o,C)=>o+C.revenue,0);return e.jsxs(S,{children:[e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center",children:e.jsx(ae,{className:"w-4 h-4 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.stakeholderName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Retail Agent"})]})]})}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium",children:a.properties.length}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"bookings"})]})}),e.jsx(d,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(Q,{className:"w-4 h-4 text-green-600"}),"$",i.toLocaleString()]})}),e.jsx(d,{className:"text-right",children:e.jsxs(y,{variant:"secondary",children:[7,"%"]})}),e.jsxs(d,{className:"text-right font-medium",children:["$",a.earnings.net.toLocaleString()]}),e.jsx(d,{children:g(a.earnings.status)}),e.jsx(d,{children:a.earnings.status==="pending"&&e.jsx(N,{size:"sm",onClick:()=>u(a.stakeholderId,a.earnings.net),children:"Mark Paid"})})]},a.stakeholderId)})})]}),t.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No retail agent commissions found for the selected period."})]})]}),t.length>0&&e.jsxs(h,{children:[e.jsx(f,{children:e.jsx(v,{children:"Sales Performance Metrics"})}),e.jsx(j,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.sort((a,i)=>i.earnings.net-a.earnings.net).map(a=>{const i=a.properties.reduce((o,C)=>o+C.revenue,0)/a.properties.length,s=a.earnings.net/a.properties.length;return e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(pe,{className:"w-4 h-4 text-purple-600"}),e.jsx("h4",{className:"font-medium",children:a.stakeholderName})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Bookings:"}),e.jsx("span",{children:a.properties.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Avg Booking Value:"}),e.jsxs("span",{children:["$",i.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Commission/Booking:"}),e.jsxs("span",{children:["$",Math.round(s).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Earned:"}),e.jsxs("span",{className:"font-medium",children:["$",a.earnings.net.toLocaleString()]})]})]})]},a.stakeholderId)})})})]}),e.jsxs(h,{children:[e.jsx(f,{children:e.jsx(v,{children:"Monthly Booking Performance"})}),e.jsx(j,{children:e.jsx("div",{className:"h-64 flex items-center justify-center bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(W,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Booking performance chart"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Would show monthly trends and targets"})]})})})]})]})}function Oe({filters:r}){const c=new URLSearchParams;r.startDate&&c.set("startDate",r.startDate.toISOString()),r.endDate&&c.set("endDate",r.endDate.toISOString()),r.stakeholderIds&&c.set("staffIds",r.stakeholderIds.join(","));const{data:t=[],isLoading:m}=k({queryKey:[`/api/admin/finance/staff-wages?${c}`]}),u=(s,o)=>{console.log("Mark paid:",s,o)},g=s=>{switch(s){case"paid":return e.jsxs(y,{variant:"default",className:"bg-green-100 text-green-800",children:[e.jsx(B,{className:"w-3 h-3 mr-1"}),"Paid"]});case"queued":return e.jsxs(y,{variant:"secondary",children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"Queued"]});default:return e.jsxs(y,{variant:"outline",children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"Pending"]})}},p=s=>{const o={"Head of Housekeeping":"bg-blue-100 text-blue-800","Maintenance Manager":"bg-green-100 text-green-800","Guest Services":"bg-purple-100 text-purple-800","Property Coordinator":"bg-orange-100 text-orange-800"};return e.jsx(y,{variant:"secondary",className:o[s]||"bg-gray-100 text-gray-800",children:s})};if(m)return e.jsx("div",{className:"animate-pulse space-y-4",children:Array.from({length:5}).map((s,o)=>e.jsx("div",{className:"h-16 bg-gray-200 rounded"},o))});const n=t.reduce((s,o)=>s+o.earnings.net,0),a=t.reduce((s,o)=>s+o.earnings.gross,0),i=t.reduce((s,o)=>s+o.earnings.deductions,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(h,{children:[e.jsx(f,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5"}),"Staff Wages Summary"]})}),e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Net Wages"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",n.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Gross Wages"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",a.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Deductions"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",i.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Staff Members"}),e.jsx("p",{className:"text-2xl font-bold",children:t.length})]})]})})]}),e.jsxs(h,{children:[e.jsx(f,{children:e.jsx(v,{children:"Staff Wage Payments"})}),e.jsxs(j,{children:[e.jsxs(A,{children:[e.jsx($,{children:e.jsxs(S,{children:[e.jsx(l,{children:"Staff Member"}),e.jsx(l,{children:"Position"}),e.jsx(l,{className:"text-right",children:"Gross Wage"}),e.jsx(l,{className:"text-right",children:"Deductions"}),e.jsx(l,{className:"text-right",children:"Net Pay"}),e.jsx(l,{children:"Status"}),e.jsx(l,{children:"Actions"})]})}),e.jsx(T,{children:t.map(s=>e.jsxs(S,{children:[e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center",children:e.jsx(Ne,{className:"w-4 h-4 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.stakeholderName}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: ",s.stakeholderId]})]})]})}),e.jsx(d,{children:p(s.position)}),e.jsx(d,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(J,{className:"w-4 h-4 text-green-600"}),"$",s.earnings.gross.toLocaleString()]})}),e.jsxs(d,{className:"text-right",children:[e.jsxs("div",{className:"text-red-600",children:["-$",s.earnings.deductions.toLocaleString()]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Tax & Benefits"})]}),e.jsxs(d,{className:"text-right font-medium",children:["$",s.earnings.net.toLocaleString()]}),e.jsx(d,{children:g(s.earnings.status)}),e.jsx(d,{children:s.earnings.status==="pending"&&e.jsx(N,{size:"sm",onClick:()=>u(s.stakeholderId,s.earnings.net),children:"Mark Paid"})})]},s.stakeholderId))})]}),t.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No staff wage records found for the selected period."})]})]}),t.length>0&&e.jsxs(h,{children:[e.jsx(f,{children:e.jsx(v,{children:"Payroll Breakdown by Position"})}),e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"Wages by Position"}),e.jsx("div",{className:"space-y-3",children:t.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-indigo-500 rounded-full"}),e.jsx("span",{className:"text-sm",children:s.position})]}),e.jsxs("span",{className:"font-medium",children:["$",s.earnings.net.toLocaleString()]})]},s.stakeholderId))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"Common Deductions"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg",children:[e.jsx("span",{className:"text-sm",children:"Income Tax"}),e.jsxs("span",{className:"font-medium",children:["$",Math.round(i*.6).toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg",children:[e.jsx("span",{className:"text-sm",children:"Social Security"}),e.jsxs("span",{className:"font-medium",children:["$",Math.round(i*.25).toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg",children:[e.jsx("span",{className:"text-sm",children:"Health Insurance"}),e.jsxs("span",{className:"font-medium",children:["$",Math.round(i*.15).toLocaleString()]})]})]})]})]})})]}),e.jsxs(h,{children:[e.jsx(f,{children:e.jsx(v,{children:"Payroll Schedule"})}),e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(W,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-medium",children:"Next Payroll"})]}),e.jsx("p",{className:"text-2xl font-bold mb-1",children:"Dec 31, 2024"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Monthly payroll processing"})]}),e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(B,{className:"w-5 h-5 text-green-600"}),e.jsx("h4",{className:"font-medium",children:"Last Processed"})]}),e.jsx("p",{className:"text-2xl font-bold mb-1",children:"Nov 30, 2024"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"All payments completed"})]}),e.jsxs("div",{className:"p-4 bg-orange-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(P,{className:"w-5 h-5 text-orange-600"}),e.jsx("h4",{className:"font-medium",children:"Pending Actions"})]}),e.jsx("p",{className:"text-2xl font-bold mb-1",children:t.filter(s=>s.earnings.status==="pending").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Staff payments pending"})]})]})})]})]})}function qe(){const{toast:r}=fe(),c=ve(),[t,m]=E.useState(!1),[u,g]=E.useState(null),{data:p,isLoading:n}=k({queryKey:["/api/admin/finance/commission-settings"]}),{data:a=[]}=k({queryKey:["/api/users"]}),{data:i=[]}=k({queryKey:["/api/properties"]}),s=ye({mutationFn:x=>be("/api/admin/finance/commission-settings",{method:"PUT",body:JSON.stringify(x)}),onSuccess:()=>{c.invalidateQueries({queryKey:["/api/admin/finance/commission-settings"]}),m(!1),g(null),r({title:"Settings Updated",description:"Commission settings have been successfully updated."})},onError:()=>{r({title:"Error",description:"Failed to update commission settings.",variant:"destructive"})}}),o=()=>{g(JSON.parse(JSON.stringify(p))),m(!0)},C=()=>{s.mutate(u)},je=()=>{m(!1),g(null)},ge=a.filter(x=>x.role==="portfolio-manager"||x.role==="admin");if(n||!p)return e.jsx("div",{className:"animate-pulse space-y-4",children:Array.from({length:3}).map((x,b)=>e.jsx("div",{className:"h-32 bg-gray-200 rounded"},b))});const I=t?u:p;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5"}),"Commission Settings"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure commission rates and splits for all stakeholders"})]}),e.jsx("div",{className:"flex gap-2",children:t?e.jsxs(e.Fragment,{children:[e.jsxs(N,{variant:"outline",onClick:je,disabled:s.isPending,children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(N,{onClick:C,disabled:s.isPending,children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Save Changes"]})]}):e.jsxs(N,{onClick:o,children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Edit Settings"]})})]}),e.jsxs(h,{children:[e.jsx(f,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"Property Manager Commission Splits"]})}),e.jsxs(j,{children:[e.jsxs(A,{children:[e.jsx($,{children:e.jsxs(S,{children:[e.jsx(l,{children:"Property Manager"}),e.jsx(l,{children:"Commission Split %"}),e.jsx(l,{children:"Properties Managed"}),t&&e.jsx(l,{children:"Actions"})]})}),e.jsx(T,{children:Object.entries(I.propertyManagerSplits||{}).map(([x,b])=>{const D=a.find(w=>w.id===x),U=D?`${D.firstName} ${D.lastName}`:x;return e.jsxs(S,{children:[e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-blue-600"}),U]})}),e.jsx(d,{children:t?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{type:"number",value:b.splitPercentage,onChange:w=>{const M={...u};M.propertyManagerSplits[x].splitPercentage=parseInt(w.target.value),g(M)},className:"w-20"}),e.jsx(ke,{className:"w-4 h-4 text-gray-400"})]}):e.jsxs("span",{children:[b.splitPercentage,"%"]})}),e.jsxs(d,{children:[b.properties.length," properties"]}),t&&e.jsx(d,{children:e.jsx(N,{variant:"outline",size:"sm",onClick:()=>{const w={...u};delete w.propertyManagerSplits[x],g(w)},children:"Remove"})})]},x)})})]}),t&&e.jsx("div",{className:"mt-4",children:e.jsxs(de,{children:[e.jsx(ce,{asChild:!0,children:e.jsxs(N,{variant:"outline",size:"sm",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Add Property Manager"]})}),e.jsxs(oe,{children:[e.jsx(xe,{children:e.jsx(me,{children:"Add Property Manager"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(L,{children:"Property Manager"}),e.jsxs(V,{children:[e.jsx(_,{children:e.jsx(H,{placeholder:"Select property manager"})}),e.jsx(Y,{children:ge.map(x=>e.jsxs(R,{value:x.id,children:[x.firstName," ",x.lastName]},x.id))})]})]}),e.jsxs("div",{children:[e.jsx(L,{children:"Commission Split %"}),e.jsx(F,{type:"number",placeholder:"50"})]}),e.jsx(N,{className:"w-full",children:"Add Manager"})]})]})]})})]})]}),e.jsxs(h,{children:[e.jsx(f,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"Owner Contract Rates (Management Fee %)"]})}),e.jsx(j,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(I.ownerContractRates||{}).map(([x,b])=>{const U=i.find(w=>w.id===parseInt(x))?.name||`Property ${x}`;return e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(K,{className:"w-4 h-4 text-blue-600"}),e.jsx("h4",{className:"font-medium",children:U})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"text-sm",children:"Management Fee:"}),t?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(F,{type:"number",value:b,onChange:w=>{const M={...u};M.ownerContractRates[x]=parseInt(w.target.value),g(M)},className:"w-16 h-8"}),e.jsx("span",{className:"text-sm",children:"%"})]}):e.jsxs("span",{className:"font-medium",children:[b,"%"]})]})]},x)})})})]}),e.jsxs(h,{children:[e.jsx(f,{children:e.jsx(v,{children:"Agent Commission Rates"})}),e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"p-4 bg-orange-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Referral Agent Rate"}),e.jsx("div",{className:"flex items-center gap-2",children:t?e.jsxs(e.Fragment,{children:[e.jsx(F,{type:"number",value:I.agentCommissionRates?.referral||5,onChange:x=>{const b={...u};b.agentCommissionRates.referral=parseInt(x.target.value),g(b)},className:"w-20"}),e.jsx("span",{children:"% of booking value"})]}):e.jsxs("span",{className:"text-2xl font-bold",children:[I.agentCommissionRates?.referral||5,"%"]})}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Commission for referred bookings"})]}),e.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Retail Agent Rate"}),e.jsx("div",{className:"flex items-center gap-2",children:t?e.jsxs(e.Fragment,{children:[e.jsx(F,{type:"number",value:I.agentCommissionRates?.retail||7,onChange:x=>{const b={...u};b.agentCommissionRates.retail=parseInt(x.target.value),g(b)},className:"w-20"}),e.jsx("span",{children:"% of booking value"})]}):e.jsxs("span",{className:"text-2xl font-bold",children:[I.agentCommissionRates?.retail||7,"%"]})}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Commission for direct sales"})]})]})})]}),e.jsxs(h,{children:[e.jsx(f,{children:e.jsx(v,{children:"Staff Wage Rates (Monthly)"})}),e.jsx(j,{children:e.jsx("div",{className:"space-y-4",children:Object.entries(I.staffWageRates||{}).map(([x,b])=>{const D=a.find(w=>w.id===x),U=D?`${D.firstName} ${D.lastName}`:x;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:U}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Staff Member"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Monthly Rate:"}),t?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"$"}),e.jsx(F,{type:"number",value:b,onChange:w=>{const M={...u};M.staffWageRates[x]=parseInt(w.target.value),g(M)},className:"w-24 h-8"})]}):e.jsxs("span",{className:"font-medium",children:["$",b.toLocaleString()]})]})]},x)})})})]})]})}function We(){const[r,c]=E.useState("overview"),[t,m]=E.useState({}),[u,g]=E.useState(!1),{data:p,isLoading:n}=k({queryKey:["/api/admin/finance/overview",t],enabled:!0}),a=i=>{const s=new URLSearchParams;t.startDate&&s.set("startDate",t.startDate.toISOString()),t.endDate&&s.set("endDate",t.endDate.toISOString()),t.propertyIds&&s.set("propertyIds",t.propertyIds.join(","));const o=`/api/admin/finance/export/${i}?${s}`;window.open(o,"_blank")};return n?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded mb-4"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:Array.from({length:4}).map((i,s)=>e.jsx("div",{className:"h-24 bg-gray-200 rounded"},s))})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Admin Finance"}),e.jsx("p",{className:"text-muted-foreground",children:"Unified financial management for all stakeholders"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(N,{variant:"outline",onClick:()=>g(!u),className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Filters"]}),e.jsxs(N,{onClick:()=>a(r),className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4"}),"Export"]})]})]}),u&&e.jsx(h,{children:e.jsx(j,{className:"p-4",children:e.jsx(Le,{filters:t,onFiltersChange:m})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(h,{children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Revenue"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",p?.totalRevenue?.toLocaleString()||"0"]})]}),e.jsx(J,{className:"w-8 h-8 text-green-600"})]})})}),e.jsx(h,{children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Management Fees"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",p?.managementFeeEarned?.toLocaleString()||"0"]})]}),e.jsx(K,{className:"w-8 h-8 text-blue-600"})]})})}),e.jsx(h,{children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Owner Payouts"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",p?.ownerPayout?.toLocaleString()||"0"]})]}),e.jsx(te,{className:"w-8 h-8 text-purple-600"})]})})}),e.jsx(h,{children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Company Retention"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",p?.companyRetention?.toLocaleString()||"0"]})]}),e.jsx(Q,{className:"w-8 h-8 text-orange-600"})]})})})]}),e.jsx(h,{children:e.jsx(j,{className:"p-0",children:e.jsxs(Me,{value:r,onValueChange:c,children:[e.jsx(f,{className:"pb-4",children:e.jsxs(Re,{className:"grid w-full grid-cols-6",children:[e.jsxs(O,{value:"owner-payouts",className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),"Owner Payouts"]}),e.jsxs(O,{value:"pm-earnings",className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"PM Earnings"]}),e.jsxs(O,{value:"agent-referral",className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Referral"]}),e.jsxs(O,{value:"agent-retail",className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Retail"]}),e.jsxs(O,{value:"staff-wages",className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"}),"Staff Wages"]}),e.jsxs(O,{value:"settings",className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),"Settings"]})]})}),e.jsxs("div",{className:"px-6 pb-6",children:[e.jsx(q,{value:"owner-payouts",children:e.jsx(Ae,{filters:t})}),e.jsx(q,{value:"pm-earnings",children:e.jsx($e,{filters:t})}),e.jsx(q,{value:"agent-referral",children:e.jsx(Te,{filters:t})}),e.jsx(q,{value:"agent-retail",children:e.jsx(Fe,{filters:t})}),e.jsx(q,{value:"staff-wages",children:e.jsx(Oe,{filters:t})}),e.jsx(q,{value:"settings",children:e.jsx(qe,{})})]})]})})})]})}export{We as default};
