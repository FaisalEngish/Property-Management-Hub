import{au as Q,ad as $,ae as J,u as Y,af as Z,av as S,ag as W,j as e,M as D,C as m,b as u,c as y,aw as X,a as p,r as ee,s as ae,t as x,o as se,ak as P,ax as T,ay as te,az as E,v as j,aA as ie,L as n,S as ne,e as re,f as le,g as ce,h as g,I as o,d as l,ai as d,aB as b,a5 as oe,aq as de,aC as F,a1 as I,aD as me}from"./index-BgmzqeQt.js";import{r as v}from"./vendor-DazevGLP.js";import"./utils-Bf-PQeq0.js";function ge(){const{user:U}=Q(),{toast:k}=$(),z=J(),[N,_]=v.useState(!1),[R,V]=v.useState("currency"),[f,M]=v.useState({}),[C,w]=v.useState({}),{data:c=[],isLoading:H}=Y({queryKey:["/api/admin/settings"],retry:(a,r)=>S(r)?!1:a<3});v.useEffect(()=>{if(c&&Array.isArray(c)&&c.length>0){const a={};c.forEach(r=>{a[r.settingKey]=r.settingValue||""}),w(a)}},[c]);const B=Z({mutationFn:async({key:a,data:r})=>await W(`/api/admin/settings/${a}`,{method:"PUT",body:JSON.stringify(r),headers:{"Content-Type":"application/json"}}),onSuccess:()=>{z.invalidateQueries({queryKey:["/api/admin/settings"]}),k({title:"Setting Updated",description:"Platform setting has been saved successfully."})},onError:a=>{if(S(a)){k({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}k({title:"Update Failed",description:"Failed to update setting. Please try again.",variant:"destructive"})}}),t=a=>C[a]||"",i=(a,r)=>{w(h=>({...h,[a]:r}))},s=async(a,r,h,q,O=!1)=>{const G=C[a]||"";B.mutate({key:a,data:{settingKey:a,settingValue:G,settingType:r,category:h,description:q,isSecret:O}})},A=a=>{M(r=>({...r,[a]:!r[a]}))};c.filter(a=>a.category==="currency"),c.filter(a=>a.category==="commission"),c.filter(a=>a.category==="billing"),c.filter(a=>a.category==="automation"),c.filter(a=>a.category==="api");const L=[{key:"platform.currency",value:"USD",type:"string",category:"currency",description:"Default platform currency"},{key:"platform.vat_rate",value:"0.10",type:"number",category:"currency",description:"Default VAT rate (decimal, e.g., 0.10 for 10%)"},{key:"platform.currency_symbol",value:"$",type:"string",category:"currency",description:"Currency symbol for display"},{key:"commission.retail_agent_rate",value:"0.05",type:"number",category:"commission",description:"Default retail agent commission rate"},{key:"commission.referral_agent_rate",value:"0.03",type:"number",category:"commission",description:"Default referral agent commission rate"},{key:"commission.auto_calculate",value:"true",type:"boolean",category:"commission",description:"Automatically calculate commissions"},{key:"billing.addon_auto_charge",value:"true",type:"boolean",category:"billing",description:"Automatically charge add-on services"},{key:"billing.utility_tracking",value:"true",type:"boolean",category:"billing",description:"Enable automatic utility tracking"},{key:"billing.payment_reminder_days",value:"7",type:"number",category:"billing",description:"Days before payment due to send reminder"},{key:"automation.task_reminders",value:"true",type:"boolean",category:"automation",description:"Send automatic task reminders"},{key:"automation.cleanup_cycle_days",value:"30",type:"number",category:"automation",description:"Days after task completion to archive"},{key:"automation.recurring_task_advance_days",value:"3",type:"number",category:"automation",description:"Days in advance to create recurring tasks"},{key:"api.hostaway_api_key",value:"",type:"string",category:"api",description:"Hostaway API key for booking integration",isSecret:!0},{key:"api.hostaway_account_id",value:"",type:"string",category:"api",description:"Hostaway account identifier"},{key:"api.pea_api_key",value:"",type:"string",category:"api",description:"PEA (Property Exchange Australia) API key",isSecret:!0},{key:"api.pea_endpoint",value:"",type:"string",category:"api",description:"PEA API endpoint URL"}],K=async()=>{for(const a of L)c.find(h=>h.settingKey===a.key)||await s(a.key,a.type,a.category,a.description,a.isSecret||!1)};return U?.role!=="admin"?e.jsx("div",{className:"min-h-screen flex bg-background",children:e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx(D,{title:"Access Denied",subtitle:"Admin privileges required",onMobileMenuToggle:()=>_(!N)}),e.jsx("main",{className:"flex-1 flex items-center justify-center p-6",children:e.jsxs(m,{className:"w-full max-w-md",children:[e.jsx(u,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-red-500"}),"Access Restricted"]})}),e.jsx(p,{children:e.jsx("p",{className:"text-muted-foreground",children:"This area is restricted to administrators only. Contact your system admin for access."})})]})})]})}):(c.length===0&&!H&&K(),e.jsx("div",{className:"min-h-screen flex bg-background",children:e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx(D,{title:"Platform Settings",subtitle:"Configure global platform defaults and integrations",onMobileMenuToggle:()=>_(!N)}),e.jsx("main",{className:"flex-1 overflow-auto p-6",children:e.jsxs(ee,{value:R,onValueChange:V,className:"space-y-6",children:[e.jsxs(ae,{className:"grid w-full grid-cols-5",children:[e.jsxs(x,{value:"currency",className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),"Currency & VAT"]}),e.jsxs(x,{value:"commission",className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Commissions"]}),e.jsxs(x,{value:"billing",className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),"Auto-billing"]}),e.jsxs(x,{value:"automation",className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Automation"]}),e.jsxs(x,{value:"api",className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4"}),"API Credentials"]})]}),e.jsx(j,{value:"currency",className:"space-y-6",children:e.jsxs(m,{children:[e.jsx(u,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5"}),"Currency & Tax Settings"]})}),e.jsx(p,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"currency",children:"Default Currency"}),e.jsxs(ne,{value:t("platform.currency"),onValueChange:a=>{i("platform.currency",a),s("platform.currency","string","currency","Default platform currency")},children:[e.jsx(re,{"data-testid":"select-currency",children:e.jsx(le,{placeholder:"Select currency"})}),e.jsxs(ce,{children:[e.jsx(g,{value:"USD",children:"USD - US Dollar"}),e.jsx(g,{value:"EUR",children:"EUR - Euro"}),e.jsx(g,{value:"GBP",children:"GBP - British Pound"}),e.jsx(g,{value:"AUD",children:"AUD - Australian Dollar"}),e.jsx(g,{value:"CAD",children:"CAD - Canadian Dollar"}),e.jsx(g,{value:"THB",children:"THB - Thai Baht"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"currency-symbol",children:"Currency Symbol"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{id:"currency-symbol","data-testid":"input-currency-symbol",value:t("platform.currency_symbol"),onChange:a=>i("platform.currency_symbol",a.target.value),placeholder:"$"}),e.jsx(l,{onClick:()=>s("platform.currency_symbol","string","currency","Currency symbol for display"),size:"sm","data-testid":"button-save-currency-symbol",children:e.jsx(d,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"vat-rate",children:"Default VAT Rate (%)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{id:"vat-rate","data-testid":"input-vat-rate",type:"number",step:"0.01",min:"0",max:"100",value:parseFloat(t("platform.vat_rate")||"0")*100,onChange:a=>i("platform.vat_rate",(parseFloat(a.target.value)/100).toString()),placeholder:"10"}),e.jsx(l,{onClick:()=>s("platform.vat_rate","number","currency","Default VAT rate (decimal)"),size:"sm","data-testid":"button-save-vat-rate",children:e.jsx(d,{className:"h-4 w-4"})})]})]})]})})]})}),e.jsx(j,{value:"commission",className:"space-y-6",children:e.jsxs(m,{children:[e.jsx(u,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),"Commission Rules"]})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"retail-commission",children:"Retail Agent Commission (%)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{id:"retail-commission","data-testid":"input-retail-commission",type:"number",step:"0.01",min:"0",max:"100",value:parseFloat(t("commission.retail_agent_rate")||"0")*100,onChange:a=>i("commission.retail_agent_rate",(parseFloat(a.target.value)/100).toString()),placeholder:"5"}),e.jsx(l,{onClick:()=>s("commission.retail_agent_rate","number","commission","Default retail agent commission rate"),size:"sm","data-testid":"button-save-retail-commission",children:e.jsx(d,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"referral-commission",children:"Referral Agent Commission (%)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{id:"referral-commission","data-testid":"input-referral-commission",type:"number",step:"0.01",min:"0",max:"100",value:parseFloat(t("commission.referral_agent_rate")||"0")*100,onChange:a=>i("commission.referral_agent_rate",(parseFloat(a.target.value)/100).toString()),placeholder:"3"}),e.jsx(l,{onClick:()=>s("commission.referral_agent_rate","number","commission","Default referral agent commission rate"),size:"sm","data-testid":"button-save-referral-commission",children:e.jsx(d,{className:"h-4 w-4"})})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{id:"auto-calculate","data-testid":"toggle-auto-calculate",checked:t("commission.auto_calculate")==="true",onCheckedChange:a=>{i("commission.auto_calculate",a.toString()),s("commission.auto_calculate","boolean","commission","Automatically calculate commissions")}}),e.jsx(n,{htmlFor:"auto-calculate",children:"Automatically calculate commissions on bookings"})]})]})]})}),e.jsx(j,{value:"billing",className:"space-y-6",children:e.jsxs(m,{children:[e.jsx(u,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"Auto-billing Configuration"]})}),e.jsx(p,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{id:"addon-auto-charge","data-testid":"toggle-addon-auto-charge",checked:t("billing.addon_auto_charge")==="true",onCheckedChange:a=>{i("billing.addon_auto_charge",a.toString()),s("billing.addon_auto_charge","boolean","billing","Automatically charge add-on services")}}),e.jsx(n,{htmlFor:"addon-auto-charge",children:"Auto-charge add-on services to guest bookings"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{id:"utility-tracking","data-testid":"toggle-utility-tracking",checked:t("billing.utility_tracking")==="true",onCheckedChange:a=>{i("billing.utility_tracking",a.toString()),s("billing.utility_tracking","boolean","billing","Enable automatic utility tracking")}}),e.jsx(n,{htmlFor:"utility-tracking",children:"Enable automatic utility bill tracking"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"payment-reminder",children:"Payment Reminder (days before due)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{id:"payment-reminder","data-testid":"input-payment-reminder",type:"number",min:"1",max:"30",value:t("billing.payment_reminder_days"),onChange:a=>i("billing.payment_reminder_days",a.target.value),placeholder:"7"}),e.jsx(l,{onClick:()=>s("billing.payment_reminder_days","number","billing","Days before payment due to send reminder"),size:"sm","data-testid":"button-save-payment-reminder",children:e.jsx(d,{className:"h-4 w-4"})})]})]})]})})]})}),e.jsx(j,{value:"automation",className:"space-y-6",children:e.jsxs(m,{children:[e.jsx(u,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5"}),"Task Automation Settings"]})}),e.jsx(p,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{id:"task-reminders","data-testid":"toggle-task-reminders",checked:t("automation.task_reminders")==="true",onCheckedChange:a=>{i("automation.task_reminders",a.toString()),s("automation.task_reminders","boolean","automation","Send automatic task reminders")}}),e.jsx(n,{htmlFor:"task-reminders",children:"Send automatic task reminders to assignees"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"cleanup-cycle",children:"Cleanup Cycle (days)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{id:"cleanup-cycle","data-testid":"input-cleanup-cycle",type:"number",min:"1",max:"365",value:t("automation.cleanup_cycle_days"),onChange:a=>i("automation.cleanup_cycle_days",a.target.value),placeholder:"30"}),e.jsx(l,{onClick:()=>s("automation.cleanup_cycle_days","number","automation","Days after task completion to archive"),size:"sm","data-testid":"button-save-cleanup-cycle",children:e.jsx(d,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"recurring-advance",children:"Recurring Task Advance (days)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{id:"recurring-advance","data-testid":"input-recurring-advance",type:"number",min:"1",max:"30",value:t("automation.recurring_task_advance_days"),onChange:a=>i("automation.recurring_task_advance_days",a.target.value),placeholder:"3"}),e.jsx(l,{onClick:()=>s("automation.recurring_task_advance_days","number","automation","Days in advance to create recurring tasks"),size:"sm","data-testid":"button-save-recurring-advance",children:e.jsx(d,{className:"h-4 w-4"})})]})]})]})]})})]})}),e.jsx(j,{value:"api",className:"space-y-6",children:e.jsxs(m,{children:[e.jsx(u,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),"External API Credentials"]})}),e.jsxs(p,{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 border border-orange-200 bg-orange-50 rounded-lg dark:border-orange-800 dark:bg-orange-950",children:[e.jsxs("div",{className:"flex items-center gap-2 text-orange-800 dark:text-orange-200",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Security Notice"})]}),e.jsx("p",{className:"text-sm text-orange-700 dark:text-orange-300 mt-1",children:"API credentials are encrypted and stored securely. Only administrators can view or modify these values."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Hostaway Integration"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"hostaway-key",children:"API Key"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(o,{id:"hostaway-key","data-testid":"input-hostaway-key",type:f["hostaway-key"]?"text":"password",value:t("api.hostaway_api_key"),onChange:a=>i("api.hostaway_api_key",a.target.value),placeholder:"Enter Hostaway API key"}),e.jsx(l,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>A("hostaway-key"),"data-testid":"button-toggle-hostaway-key",children:f["hostaway-key"]?e.jsx(F,{className:"h-4 w-4"}):e.jsx(I,{className:"h-4 w-4"})})]}),e.jsx(l,{onClick:()=>s("api.hostaway_api_key","string","api","Hostaway API key for booking integration",!0),size:"sm","data-testid":"button-save-hostaway-key",children:e.jsx(d,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"hostaway-account",children:"Account ID"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{id:"hostaway-account","data-testid":"input-hostaway-account",value:t("api.hostaway_account_id"),onChange:a=>i("api.hostaway_account_id",a.target.value),placeholder:"Enter Hostaway account ID"}),e.jsx(l,{onClick:()=>s("api.hostaway_account_id","string","api","Hostaway account identifier"),size:"sm","data-testid":"button-save-hostaway-account",children:e.jsx(d,{className:"h-4 w-4"})})]})]})]})]}),e.jsx(me,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"PEA Integration"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"pea-key",children:"API Key"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(o,{id:"pea-key","data-testid":"input-pea-key",type:f["pea-key"]?"text":"password",value:t("api.pea_api_key"),onChange:a=>i("api.pea_api_key",a.target.value),placeholder:"Enter PEA API key"}),e.jsx(l,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>A("pea-key"),"data-testid":"button-toggle-pea-key",children:f["pea-key"]?e.jsx(F,{className:"h-4 w-4"}):e.jsx(I,{className:"h-4 w-4"})})]}),e.jsx(l,{onClick:()=>s("api.pea_api_key","string","api","PEA API key",!0),size:"sm","data-testid":"button-save-pea-key",children:e.jsx(d,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"pea-endpoint",children:"Endpoint URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{id:"pea-endpoint","data-testid":"input-pea-endpoint",value:t("api.pea_endpoint"),onChange:a=>i("api.pea_endpoint",a.target.value),placeholder:"Enter PEA endpoint URL"}),e.jsx(l,{onClick:()=>s("api.pea_endpoint","string","api","PEA API endpoint URL"),size:"sm","data-testid":"button-save-pea-endpoint",children:e.jsx(d,{className:"h-4 w-4"})})]})]})]})]})]})]})})]})})]})}))}export{ge as default};
